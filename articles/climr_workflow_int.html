<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="More advanced `climr` workflows.
">
<title>`climr` workflow - intermediate • climr</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="`climr` workflow - intermediate">
<meta property="og:description" content="More advanced `climr` workflows.
">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">climr</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.0.2.9006</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/caching.html">caching</a>
    <a class="dropdown-item" href="../articles/climr_with_rasters.html">Working with rasters and other spatial objects</a>
    <a class="dropdown-item" href="../articles/climr_workflow_beg.html">`climr` workflow - beginner</a>
    <a class="dropdown-item" href="../articles/climr_workflow_int.html">`climr` workflow - intermediate</a>
    <a class="dropdown-item" href="../articles/lapse_rates.html">Lapse rates</a>
    <a class="dropdown-item" href="../articles/methods_downscaling.html">`climr` downscaling methods</a>
  </div>
</li>
<li class="nav-item">
  <a class="nav-link" href="../news/index.html">Changelog</a>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav"></ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="" class="logo" alt=""><h1>`climr` workflow - intermediate</h1>
            
      
      
      <div class="d-none name"><code>climr_workflow_int.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<p><code>climr</code> is in essence similar to <a href="climatena.ca">ClimateNA</a> in that it downscales low-resolution
(~100km) global climate model anomalies to high-resolution (1-4km) maps
of climate, with further elevation adjustment to user-specified
elevation grids/points based on empirical lapse rates (local
relationship of climate to elevation) of the 1-4km climate maps. The
elevation-adjusted monthly values of basic climate elements (temperature
and precipitation) are then used to estimate derived variables (e.g.,
degree-days, precipitation as snow) based on published equations and
parameters from <span class="citation">(<a href="#ref-wang2016" role="doc-biblioref">Wang et al. 2016</a>)</span>.</p>
<p>See <code>vignette("methods_downscaling.Rmd")</code> for a detailed
explanation of the downscaling methodology employed in
<code>climr</code>.</p>
<p><code>climr</code>’s strenghts are:</p>
<ol style="list-style-type: decimal">
<li>its ability to obtain multiple, individual runs of a (or several)
General Circulation Model(s) (GCM), as well as the ensemble cross-run
mean,</li>
</ol>
<!-- benchmark Speed and add it here --><ol start="2" style="list-style-type: decimal">
<li><p>cloud-based raw data access and local data caching,</p></li>
<li><p>and direct <code>R</code> interface to downscaled climate
elements and derived variables covering western Canada and western
US.</p></li>
</ol>
<p>In this vignette we cover two basic <code>climr</code> workflows to
obtain historic and future climate projections of a few derived
variables.</p>
<p>The first, less code-heavy, workflow uses
<code><a href="../reference/climr_downscale.html">climr_downscale()</a></code> to do much of the heavy lifting –
[Workflow with climr_downscale]. The second workflow is a step-by-step
breakdown of <code><a href="../reference/climr_downscale.html">climr_downscale()</a></code> using the functions
<code><a href="../reference/climr_downscale.html">climr_downscale()</a></code> calls internally – [Workflow with *_input
functions and downscale].</p>
</div>
<div class="section level2">
<h2 id="main-functions">Main functions<a class="anchor" aria-label="anchor" href="#main-functions"></a>
</h2>
<p>Below is a list of the main functions used in the two workflows.</p>
<ul>
<li><p><code><a href="../reference/climr_downscale.html">climr_downscale()</a></code> takes a <code>data.table</code> of
point coordinates (in lat-long projection), obtains climate normals and
historic and/or future projections covering the extent of the points,
which are then downscaled using point elevation data and used to
calculate derived climate variables at the point locations. It outputs
the downscaled and derived variables in the form of a
<code>data.table</code> or <code>SpatVector</code> of points.</p></li>
<li><p><code><a href="../reference/normal-input-data.html">normal_input()</a></code> downloads and prepares
high-resolution climate normals. Called internally by
<code><a href="../reference/climr_downscale.html">climr_downscale()</a></code>.</p></li>
<li><p><code><a href="../reference/hist-input-data.html">historic_input()</a></code> and
<code><a href="../reference/hist-input-data.html">historic_input_ts()</a></code> download and prepare low-resolution
historic climate elements for a given historic period or time series,
respectively. Called internally by
<code><a href="../reference/climr_downscale.html">climr_downscale()</a></code>.</p></li>
<li><p><code><a href="../reference/gcm-input-data.html">gcm_input()</a></code>, <code><a href="../reference/gcm-input-data.html">gcm_hist_input()</a></code> and
<code><a href="../reference/gcm-input-data.html">gcm_ts_input()</a></code> download and prepare low-resolution climate
element projections for a future period, historic period or future time
series, respectively. Called internally by
<code><a href="../reference/climr_downscale.html">climr_downscale()</a></code>.</p></li>
<li><p><code><a href="../reference/downscale.html">downscale()</a></code> downscales historic or future climate
elements and calculates derived climate variables. Called by
<code><a href="../reference/climr_downscale.html">climr_downscale()</a></code>.</p></li>
</ul>
</div>
<div class="section level2">
<h2 id="workflow-with-climr_downscale">Workflow with <code>climr_downscale</code><a class="anchor" aria-label="anchor" href="#workflow-with-climr_downscale"></a>
</h2>
<p>In this example workflow we use <code><a href="../reference/climr_downscale.html">climr_downscale()</a></code> to
calculate mean annual temperature (MAT), total annual precipitation
(PPT) and precipitation as snow (PAS) at weather stations associated
with the <a href="https://www.canada.ca/en/environment-climate-change/services/climate-change/science-research-data/climate-trends-variability/adjusted-homogenized-canadian-data.html" class="external-link">Adjusted
and homogenized Canadian climate data</a>.</p>
<p>We will downscale MAT, PPT and MAS at these locations for a historic
and a future period, using two separate runs of a GCM and one emissions
scenario.</p>
<p>We begin by loading the Adjusted Precipitation for Canada (APC2)
dataset and clipping it to the North Vancouver area. This dataset
already contains elevation information.</p>
<p>Note that longitude (‘lon’) and latitude (‘lat’) must be in lat-long
projection (EPSG:4326) and elevation in m. Point IDs must be unique – we
will use the weather station IDs.</p>
<p>We will also add two other columns in our <code>data.table</code>
(‘ZONE’ and ‘HEZ’) these are ignored by <code><a href="../reference/climr_downscale.html">climr_downscale()</a></code>.
<code><a href="../reference/climr_downscale.html">climr_downscale()</a></code> preserves the IDs and we use them to join
back the extra columns used for plotting later on.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">climr</span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://r-datatable.com" class="external-link">data.table</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://rspatial.org/" class="external-link">terra</a></span><span class="op">)</span></span>
<span></span>
<span><span class="co">## weather station locations</span></span>
<span><span class="va">weather_stations</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/get.html" class="external-link">get</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="st">"weather_stations"</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://rspatial.github.io/terra/reference/wrap.html" class="external-link">unwrap</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="co">## study area of interest (North Vancouver)</span></span>
<span><span class="va">vancouver_poly</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/get.html" class="external-link">get</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="st">"vancouver_poly"</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://rspatial.github.io/terra/reference/wrap.html" class="external-link">unwrap</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="co">## subset to points in study area</span></span>
<span><span class="va">weather_stations</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rspatial.github.io/terra/reference/mask.html" class="external-link">mask</a></span><span class="op">(</span><span class="va">weather_stations</span>, <span class="va">vancouver_poly</span><span class="op">)</span></span>
<span></span>
<span><span class="co">## convert to data.table and subset/rename columns needed by climr</span></span>
<span><span class="va">xyzDT</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdatatable.gitlab.io/data.table/reference/as.data.table.html" class="external-link">as.data.table</a></span><span class="op">(</span><span class="va">weather_stations</span>, geom <span class="op">=</span> <span class="st">"XY"</span><span class="op">)</span></span>
<span><span class="va">cols</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Station ID"</span>, <span class="st">"x"</span>, <span class="st">"y"</span>, <span class="st">"Elevation (m)"</span><span class="op">)</span></span>
<span><span class="va">xyzDT</span> <span class="op">&lt;-</span> <span class="va">xyzDT</span><span class="op">[</span>, <span class="va">..cols</span><span class="op">]</span></span>
<span><span class="fu"><a href="https://rdatatable.gitlab.io/data.table/reference/setattr.html" class="external-link">setnames</a></span><span class="op">(</span><span class="va">xyzDT</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"id"</span>, <span class="st">"lon"</span>, <span class="st">"lat"</span>, <span class="st">"elev"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co">## join BEC zones and colours</span></span>
<span><span class="va">BECz_vancouver</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/get.html" class="external-link">get</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="st">"BECz_vancouver"</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://rspatial.github.io/terra/reference/wrap.html" class="external-link">unwrap</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="va">BECz_points</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rspatial.github.io/terra/reference/extract.html" class="external-link">extract</a></span><span class="op">(</span><span class="va">BECz_vancouver</span>, <span class="va">weather_stations</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://rdatatable.gitlab.io/data.table/reference/as.data.table.html" class="external-link">as.data.table</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">BECz_points</span> <span class="op">&lt;-</span> <span class="va">BECz_points</span><span class="op">[</span>, <span class="fu">.</span><span class="op">(</span><span class="va">ZONE</span>, <span class="va">HEX</span><span class="op">)</span><span class="op">]</span></span>
<span></span>
<span><span class="va">xyzDT</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="va">xyzDT</span>, <span class="va">BECz_points</span><span class="op">)</span></span>
<span></span>
<span><span class="co">## remove duplicates</span></span>
<span><span class="va">xyzDT</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rspatial.github.io/terra/reference/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">xyzDT</span><span class="op">)</span></span>
<span></span>
<span><span class="co">## there are some duplicate stations with slightly different </span></span>
<span><span class="co">## coordinates. We'll take the first</span></span>
<span><span class="va">xyzDT</span> <span class="op">&lt;-</span> <span class="va">xyzDT</span><span class="op">[</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/duplicated.html" class="external-link">duplicated</a></span><span class="op">(</span><span class="va">id</span><span class="op">)</span><span class="op">]</span></span></code></pre></div>
<div class="figure" style="text-align: center">
<img src="climr_workflow_int_files/figure-html/unnamed-chunk-3-1.png" alt="Weather stations in North Vancouver" width="70%"><p class="caption">
Weather stations in North Vancouver
</p>
</div>
<p>The <code>list_*()</code> functions below provide a list of available
historic and future periods, GCMs, emissions scenarios, and derived
variables (in this case only the annual ones).</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/data-option-lists.html">list_historic</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "2001_2020"</span></span></code></pre></div>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/data-option-lists.html">list_gcm_period</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "2001_2020" "2021_2040" "2041_2060" "2061_2080" "2081_2100"</span></span></code></pre></div>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/data-option-lists.html">list_gcm</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt;  [1] "ACCESS-ESM1-5" "BCC-CSM2-MR"   "CanESM5"       "CNRM-ESM2-1"  </span></span>
<span><span class="co">#&gt;  [5] "EC-Earth3"     "GFDL-ESM4"     "GISS-E2-1-G"   "INM-CM5-0"    </span></span>
<span><span class="co">#&gt;  [9] "IPSL-CM6A-LR"  "MIROC6"        "MPI-ESM1-2-HR" "MRI-ESM2-0"   </span></span>
<span><span class="co">#&gt; [13] "UKESM1-0-LL"</span></span></code></pre></div>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/data-option-lists.html">list_ssp</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "ssp126" "ssp245" "ssp370" "ssp585"</span></span></code></pre></div>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/data-option-lists.html">list_variables</a></span><span class="op">(</span>set <span class="op">=</span> <span class="st">"Annual"</span><span class="op">)</span></span>
<span><span class="co">#&gt;  [1] "AHM"   "bFFP"  "CMD"   "CMI"   "DD_0"  "DD_18" "DD18"  "DD5"   "eFFP" </span></span>
<span><span class="co">#&gt; [10] "EMT"   "Eref"  "EXT"   "FFP"   "MAP"   "MAT"   "MCMT"  "MSP"   "MWMT" </span></span>
<span><span class="co">#&gt; [19] "NFFD"  "PAS"   "PPT"   "RH"    "SHM"   "Tave"  "TD"    "Tmax"  "Tmin"</span></span></code></pre></div>
<p>We will chose the only available historic period (2001-2020), the
2021-2040 future period, the ‘EC-Earth3’ GCM and the SSP 2.45 scenario.
MAT, PPT and PAS will be selected as output variables.</p>
<p>We pass our choices to <code><a href="../reference/climr_downscale.html">climr_downscale()</a></code>, choosing the
“auto” normals option (which defaults to using the highest resolution
data available for the points selected).</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ds_out</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/climr_downscale.html">climr_downscale</a></span><span class="op">(</span></span>
<span>  xyz <span class="op">=</span> <span class="va">xyzDT</span>,</span>
<span>  which_normal <span class="op">=</span> <span class="st">"auto"</span>,</span>
<span>  historic_period <span class="op">=</span> <span class="st">"2001_2020"</span>,</span>
<span>  gcm_period <span class="op">=</span> <span class="st">"2021_2040"</span>,</span>
<span>  gcm_models <span class="op">=</span> <span class="st">"EC-Earth3"</span>,</span>
<span>  ssp <span class="op">=</span> <span class="st">"ssp245"</span>,</span>
<span>  max_run <span class="op">=</span> <span class="fl">2</span>,</span>
<span>  return_normal <span class="op">=</span> <span class="cn">TRUE</span>, <span class="co">## to return the 1961-1990 normals period</span></span>
<span>  vars <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"MAT"</span>, <span class="st">"PPT"</span>, <span class="st">"PAS"</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; Welcome to climr!</span></span>
<span><span class="co">#&gt; Getting normals...</span></span>
<span><span class="co">#&gt; for BC...</span></span>
<span><span class="co">#&gt; Downloading new data...</span></span>
<span><span class="co">#&gt; .</span></span>
<span><span class="co">#&gt; Caching data...</span></span>
<span><span class="co">#&gt; Getting historic...</span></span>
<span><span class="co">#&gt; Downloading historic anomalies</span></span>
<span><span class="co">#&gt; .</span></span>
<span><span class="co">#&gt; Caching data...</span></span>
<span><span class="co">#&gt; Getting GCMs...</span></span>
<span><span class="co">#&gt; Downloading GCM anomalies</span></span>
<span><span class="co">#&gt; .</span></span>
<span><span class="co">#&gt; Caching data...</span></span>
<span><span class="co">#&gt; Downscaling!!</span></span></code></pre></div>
<p>Note how data from historical periods doesn’t have a GCM or SSP value
– this is expected , as GCMs and SSPs are used to project future climate
values. Also, future projections were obtained for two runs of EC-Earth3
(‘r1i1p1f1’ and ‘r10i1p1f1’), plus the ensemble mean.</p>
<table style="width:100%;" class="table">
<caption>‘ds_out’ table - Output from <code>climr_downscale</code>.
Outputs are show for one location (‘id’)</caption>
<colgroup>
<col width="4%">
<col width="14%">
<col width="9%">
<col width="18%">
<col width="14%">
<col width="14%">
<col width="12%">
<col width="12%">
</colgroup>
<thead><tr class="header">
<th align="right">id</th>
<th align="left">GCM</th>
<th align="left">SSP</th>
<th align="left">RUN</th>
<th align="left">PERIOD</th>
<th align="right">MAT</th>
<th align="right">PPT</th>
<th align="right">PAS</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="right">87</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">1961_1990</td>
<td align="right">9.738779</td>
<td align="right">2614.527</td>
<td align="right">365.0191</td>
</tr>
<tr class="even">
<td align="right">87</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">2001_2020</td>
<td align="right">10.047888</td>
<td align="right">2565.122</td>
<td align="right">316.0789</td>
</tr>
<tr class="odd">
<td align="right">87</td>
<td align="left">EC-Earth3</td>
<td align="left">ssp245</td>
<td align="left">ensembleMean</td>
<td align="left">2021_2040</td>
<td align="right">11.254584</td>
<td align="right">2682.471</td>
<td align="right">214.3795</td>
</tr>
<tr class="even">
<td align="right">87</td>
<td align="left">EC-Earth3</td>
<td align="left">ssp245</td>
<td align="left">r15i1p1f1</td>
<td align="left">2021_2040</td>
<td align="right">10.812713</td>
<td align="right">2773.671</td>
<td align="right">267.7330</td>
</tr>
<tr class="odd">
<td align="right">87</td>
<td align="left">EC-Earth3</td>
<td align="left">ssp245</td>
<td align="left">r1i1p1f1</td>
<td align="left">2021_2040</td>
<td align="right">11.460546</td>
<td align="right">2711.424</td>
<td align="right">195.9670</td>
</tr>
</tbody>
</table>
<p>To add back the extra columns we need only a simple left join.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ds_out</span> <span class="op">&lt;-</span> <span class="va">xyzDT</span><span class="op">[</span>, <span class="fu">.</span><span class="op">(</span><span class="va">id</span>, <span class="va">ZONE</span>, <span class="va">HEX</span><span class="op">)</span><span class="op">]</span><span class="op">[</span><span class="va">ds_out</span>, on <span class="op">=</span> <span class="fu">.</span><span class="op">(</span><span class="va">id</span><span class="op">)</span><span class="op">]</span></span></code></pre></div>
<p>We can now do a simple visualisation of climate variation by
biogeoclimatic zone (‘ZONE’), in the normals period of 1961-1990:</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">plotdata</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdatatable.gitlab.io/data.table/reference/melt.data.table.html" class="external-link">melt</a></span><span class="op">(</span><span class="va">ds_out</span>, measure.vars <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"MAT"</span>, <span class="st">"PPT"</span>, <span class="st">"PAS"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">cols</span> <span class="op">&lt;-</span> <span class="va">plotdata</span><span class="op">$</span><span class="va">HEX</span></span>
<span><span class="fu"><a href="https://rspatial.github.io/terra/reference/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">cols</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="va">plotdata</span><span class="op">$</span><span class="va">ZONE</span></span>
<span><span class="va">cols</span> <span class="op">&lt;-</span> <span class="va">cols</span><span class="op">[</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/duplicated.html" class="external-link">duplicated</a></span><span class="op">(</span><span class="va">cols</span><span class="op">)</span><span class="op">]</span></span>
<span></span>
<span><span class="fu">ggplot</span><span class="op">(</span><span class="va">plotdata</span><span class="op">[</span><span class="va">PERIOD</span> <span class="op">==</span> <span class="st">"1961_1990"</span><span class="op">]</span>, <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">ZONE</span>, y <span class="op">=</span> <span class="va">value</span>, fill <span class="op">=</span> <span class="va">ZONE</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_boxplot</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">theme_light</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu">scale_fill_manual</span><span class="op">(</span>values <span class="op">=</span> <span class="va">cols</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">facet_wrap</span><span class="op">(</span><span class="op">~</span> <span class="va">variable</span>, scales <span class="op">=</span> <span class="st">"free"</span><span class="op">)</span></span></code></pre></div>
<p><img src="climr_workflow_int_files/figure-html/unnamed-chunk-12-1.png" width="80%" style="display: block; margin: auto;"></p>
<p>We may also want yearly climate projections. In this case, we want
the yearly values of MAT and PPT for 2001-2015 and 2021:2040, using the
same GCM, SSP and number of model runs. Notice how some of the data
doesn’t need to be downloaded again, and was retrieved from cache.</p>
<p>The <code><a href="../reference/climr_downscale.html">climr_downscale()</a></code> internally rescales the projected
historical values so that they align with their observed counterpart.
See <code>vignette("methods_downscaling.Rmd")</code> for details.</p>
<!-- missing data for years 2016-2020 -->
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ds_out_ts</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/climr_downscale.html">climr_downscale</a></span><span class="op">(</span></span>
<span>  xyz <span class="op">=</span> <span class="va">xyzDT</span>,</span>
<span>  which_normal <span class="op">=</span> <span class="st">"auto"</span>,</span>
<span>  historic_ts <span class="op">=</span> <span class="fl">2001</span><span class="op">:</span><span class="fl">2015</span>,      <span class="co">## currently up to 2015</span></span>
<span>  gcm_hist_years <span class="op">=</span> <span class="fl">2001</span><span class="op">:</span><span class="fl">2020</span>,   <span class="co">## currently up to 2010</span></span>
<span>  gcm_ts_years <span class="op">=</span> <span class="fl">2021</span><span class="op">:</span><span class="fl">2040</span>,     <span class="co">## currently starting at 2021</span></span>
<span>  gcm_models <span class="op">=</span> <span class="st">"EC-Earth3"</span>,</span>
<span>  ssp <span class="op">=</span> <span class="st">"ssp245"</span>,</span>
<span>  max_run <span class="op">=</span> <span class="fl">1</span>,</span>
<span>  return_normal <span class="op">=</span> <span class="cn">TRUE</span>, <span class="co">## to return the 1961-1990 normals period</span></span>
<span>  vars <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"MAT"</span>, <span class="st">"PPT"</span>, <span class="st">"PAS"</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; Welcome to climr!</span></span>
<span><span class="co">#&gt; Getting normals...</span></span>
<span><span class="co">#&gt; for BC...</span></span>
<span><span class="co">#&gt; Retrieving from cache...</span></span>
<span><span class="co">#&gt; Downloading historic anomalies</span></span>
<span><span class="co">#&gt; .</span></span>
<span><span class="co">#&gt; Caching data...</span></span>
<span><span class="co">#&gt; Downloading GCM anomalies</span></span>
<span><span class="co">#&gt; Precip...</span></span>
<span><span class="co">#&gt; .</span></span>
<span><span class="co">#&gt; Tmax...</span></span>
<span><span class="co">#&gt; .</span></span>
<span><span class="co">#&gt; Tmin...</span></span>
<span><span class="co">#&gt; .</span></span>
<span><span class="co">#&gt; Caching data...</span></span>
<span><span class="co">#&gt; Downloading GCM anomalies</span></span>
<span><span class="co">#&gt; .</span></span>
<span><span class="co">#&gt; Caching data...</span></span>
<span><span class="co">#&gt; Downscaling!!</span></span></code></pre></div>
<p>To plot the time series, we will filter the data to a single model
run (i.e. in this case discard the ensemble means) and to a single point
location. Note that we plot both the observed (<code>obs_hist</code>)
and the projected historical (<code>proj_hist</code>) climate values
along with future climate projections (<code>proj_fut</code>).</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="va">ds_out_ts</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">GCM</span><span class="op">)</span>, <span class="va">GCM</span> <span class="op">:=</span> <span class="st">"Historic"</span><span class="op">]</span></span>
<span><span class="va">ds_out_ts</span> <span class="op">&lt;-</span> <span class="va">ds_out_ts</span><span class="op">[</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">grepl</a></span><span class="op">(</span><span class="st">"ensemble"</span>, <span class="va">RUN</span><span class="op">)</span><span class="op">]</span></span>
<span><span class="va">ds_out_ts</span> <span class="op">&lt;-</span> <span class="va">ds_out_ts</span><span class="op">[</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">grepl</a></span><span class="op">(</span><span class="st">"1961_1990"</span>, <span class="va">PERIOD</span><span class="op">)</span><span class="op">]</span></span>
<span></span>
<span><span class="va">plotdata</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdatatable.gitlab.io/data.table/reference/melt.data.table.html" class="external-link">melt</a></span><span class="op">(</span><span class="va">ds_out_ts</span>, measure.vars <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"MAT"</span>, <span class="st">"PPT"</span>, <span class="st">"PAS"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">plotdata</span><span class="op">[</span>, <span class="va">PERIOD</span> <span class="op">:=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="va">PERIOD</span><span class="op">)</span><span class="op">]</span></span>
<span><span class="va">plotdata</span> <span class="op">&lt;-</span> <span class="va">plotdata</span><span class="op">[</span><span class="va">id</span> <span class="op">==</span> <span class="fu"><a href="https://rspatial.github.io/terra/reference/headtail.html" class="external-link">head</a></span><span class="op">(</span><span class="va">id</span>,<span class="fl">1</span><span class="op">)</span><span class="op">]</span></span>
<span></span>
<span><span class="co">## time series period groupings</span></span>
<span><span class="va">plotdata</span><span class="op">[</span><span class="va">GCM</span> <span class="op">==</span> <span class="st">"Historic"</span>,  <span class="va">pgrp</span> <span class="op">:=</span> <span class="st">"obs_hist"</span><span class="op">]</span></span>
<span><span class="va">plotdata</span><span class="op">[</span><span class="va">GCM</span> <span class="op">!=</span> <span class="st">"Historic"</span> <span class="op">&amp;</span> <span class="va">PERIOD</span> <span class="op">&lt;=</span> <span class="fl">2020</span>,  <span class="va">pgrp</span> <span class="op">:=</span> <span class="st">"proj_hist"</span><span class="op">]</span></span>
<span><span class="va">plotdata</span><span class="op">[</span><span class="va">GCM</span> <span class="op">!=</span> <span class="st">"Historic"</span> <span class="op">&amp;</span> <span class="va">PERIOD</span> <span class="op">&gt;</span> <span class="fl">2020</span>,  <span class="va">pgrp</span> <span class="op">:=</span> <span class="st">"proj_fut"</span><span class="op">]</span></span>
<span></span>
<span><span class="co">## make groups so that missing data is not shown as a "line connection"</span></span>
<span><span class="va">groups</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdatatable.gitlab.io/data.table/reference/data.table.html" class="external-link">data.table</a></span><span class="op">(</span>PERIOD <span class="op">=</span> <span class="fu"><a href="https://rspatial.github.io/terra/reference/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">plotdata</span><span class="op">$</span><span class="va">PERIOD</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">groups</span><span class="op">[</span>, <span class="va">idx</span> <span class="op">:=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fu"><a href="https://rspatial.github.io/terra/reference/diff.html" class="external-link">diff</a></span><span class="op">(</span><span class="va">PERIOD</span><span class="op">)</span><span class="op">)</span><span class="op">]</span></span>
<span><span class="va">i2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fu"><a href="https://rdrr.io/r/base/which.html" class="external-link">which</a></span><span class="op">(</span><span class="va">groups</span><span class="op">$</span><span class="va">idx</span> <span class="op">!=</span> <span class="fl">1</span><span class="op">)</span>, <span class="fu"><a href="https://rspatial.github.io/terra/reference/dimensions.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">groups</span><span class="op">)</span> <span class="op">+</span> <span class="fl">1</span><span class="op">)</span></span>
<span><span class="va">groups</span><span class="op">[</span>, <span class="va">grp</span> <span class="op">:=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/diff.html" class="external-link">diff</a></span><span class="op">(</span><span class="va">i2</span><span class="op">)</span><span class="op">)</span>, <span class="fu"><a href="https://rspatial.github.io/terra/reference/diff.html" class="external-link">diff</a></span><span class="op">(</span><span class="va">i2</span><span class="op">)</span><span class="op">)</span><span class="op">]</span></span>
<span><span class="va">plotdata</span> <span class="op">&lt;-</span> <span class="va">groups</span><span class="op">[</span>, <span class="fu">.</span><span class="op">(</span><span class="va">PERIOD</span>, <span class="va">grp</span><span class="op">)</span><span class="op">]</span><span class="op">[</span><span class="va">plotdata</span>, on <span class="op">=</span> <span class="st">"PERIOD"</span><span class="op">]</span></span>
<span><span class="va">plotdata</span><span class="op">[</span>, <span class="va">grp</span> <span class="op">:=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="va">grp</span>, <span class="va">variable</span>, sep <span class="op">=</span> <span class="st">"_"</span><span class="op">)</span><span class="op">]</span></span>
<span></span>
<span><span class="va">yrbreaks</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">min</a></span><span class="op">(</span><span class="va">plotdata</span><span class="op">$</span><span class="va">PERIOD</span><span class="op">)</span>,</span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">min</a></span><span class="op">(</span><span class="va">plotdata</span><span class="op">$</span><span class="va">PERIOD</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="va">plotdata</span><span class="op">$</span><span class="va">PERIOD</span><span class="op">)</span>, by <span class="op">=</span> <span class="fl">5</span><span class="op">)</span>,</span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="va">plotdata</span><span class="op">$</span><span class="va">PERIOD</span><span class="op">)</span></span>
<span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://rspatial.github.io/terra/reference/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">ggplot</span><span class="op">(</span><span class="va">plotdata</span>, <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">PERIOD</span>, y <span class="op">=</span> <span class="va">value</span>, col <span class="op">=</span> <span class="va">pgrp</span>, group <span class="op">=</span> <span class="va">grp</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_line</span><span class="op">(</span>data <span class="op">=</span> <span class="va">plotdata</span><span class="op">[</span><span class="va">pgrp</span> <span class="op">==</span> <span class="st">"obs_hist"</span><span class="op">]</span>, size <span class="op">=</span> <span class="fl">1.1</span>, </span>
<span>            linejoin <span class="op">=</span> <span class="st">"round"</span>, lineend <span class="op">=</span> <span class="st">"round"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_line</span><span class="op">(</span>data <span class="op">=</span> <span class="va">plotdata</span><span class="op">[</span><span class="va">pgrp</span> <span class="op">!=</span> <span class="st">"obs_hist"</span><span class="op">]</span>, size <span class="op">=</span> <span class="fl">1.1</span>, </span>
<span>            linejoin <span class="op">=</span> <span class="st">"round"</span>, lineend <span class="op">=</span> <span class="st">"round"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">scale_x_continuous</span><span class="op">(</span>breaks <span class="op">=</span> <span class="va">yrbreaks</span>, labels <span class="op">=</span> <span class="va">yrbreaks</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">scale_color_manual</span><span class="op">(</span>values <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"obs_hist"</span> <span class="op">=</span> <span class="st">"grey"</span>,</span>
<span>                                <span class="st">"proj_hist"</span> <span class="op">=</span>  <span class="st">"forestgreen"</span>, </span>
<span>                                <span class="st">"proj_fut"</span> <span class="op">=</span> <span class="st">"navyblue"</span><span class="op">)</span>,</span>
<span>                     breaks <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"obs_hist"</span>, <span class="st">"proj_hist"</span>, <span class="st">"proj_fut"</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">theme_light</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">theme</span><span class="op">(</span>axis.text.x <span class="op">=</span> <span class="fu">element_text</span><span class="op">(</span>angle <span class="op">=</span> <span class="fl">45</span>, vjust <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">labs</span><span class="op">(</span>x <span class="op">=</span> <span class="st">"Year"</span>, col <span class="op">=</span> <span class="st">""</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">facet_wrap</span><span class="op">(</span><span class="op">~</span> <span class="va">variable</span>, scales <span class="op">=</span> <span class="st">"free"</span>, ncol <span class="op">=</span> <span class="fl">1</span>, strip.position <span class="op">=</span> <span class="st">"left"</span>, <span class="op">)</span></span></code></pre></div>
<div class="figure" style="text-align: center">
<img src="climr_workflow_int_files/figure-html/unnamed-chunk-14-1.png" alt="Time series outputs from `climr_downscale`. Pannels show mean annual temperature (MAT), total annual precipitation (PPT) and precipitation as snow (PAS). Line colours refer to observed historic values (grey), projected historic values (gren) and future projected values (blue) for a single location, GCM, emissions scenario and model run." width="80%"><p class="caption">
Time series outputs from <code>climr_downscale</code>. Pannels show mean
annual temperature (MAT), total annual precipitation (PPT) and
precipitation as snow (PAS). Line colours refer to observed historic
values (grey), projected historic values (gren) and future projected
values (blue) for a single location, GCM, emissions scenario and model
run.
</p>
</div>
<div class="section level3">
<h3 id="spatial-output-and-plotting-options">Spatial output and plotting options<a class="anchor" aria-label="anchor" href="#spatial-output-and-plotting-options"></a>
</h3>
<p><code>climr_downscale</code> can also provide outputs in the form of
a <code>SpatVector</code> of points and plot the values of a chosen
climate variable from the list passed to
<code>climr_downscale(..., vars)</code>, in this case MAT.</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ds_out_spatial</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/climr_downscale.html">climr_downscale</a></span><span class="op">(</span></span>
<span>  xyz <span class="op">=</span> <span class="va">xyzDT</span>,</span>
<span>  which_normal <span class="op">=</span> <span class="st">"auto"</span>,</span>
<span>  gcm_models <span class="op">=</span> <span class="st">"EC-Earth3"</span>, </span>
<span>  gcm_period <span class="op">=</span> <span class="st">"2021_2040"</span>,</span>
<span>  ssp <span class="op">=</span> <span class="st">"ssp245"</span>,</span>
<span>  max_run <span class="op">=</span> <span class="fl">0</span>,</span>
<span>  return_normal <span class="op">=</span> <span class="cn">FALSE</span>, <span class="co">## don't return the 1961-1990 normals period</span></span>
<span>  out_spatial <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  plot <span class="op">=</span> <span class="st">"MAT"</span>,</span>
<span>  vars <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"MAT"</span>, <span class="st">"PPT"</span>, <span class="st">"PAS"</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p><img src="climr_workflow_int_files/figure-html/unnamed-chunk-15-1.png" width="80%" style="display: block; margin: auto;"></p>
<p>And of course we can now use the vector output to map all variables
on top of our DEM raster, for prettier visuals:</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">vancouver</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/get.html" class="external-link">get</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="st">"vancouver"</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://rspatial.github.io/terra/reference/wrap.html" class="external-link">unwrap</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span>mfrow <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">2</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rspatial.github.io/terra/reference/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">vancouver_poly</span>, col <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/grDevices/palettes.html" class="external-link">hcl.colors</a></span><span class="op">(</span><span class="fl">50</span>, palette <span class="op">=</span> <span class="st">"Earth"</span><span class="op">)</span>,</span>
<span>     plg <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>x <span class="op">=</span> <span class="st">"bottom"</span>, title <span class="op">=</span> <span class="st">"Elevation"</span><span class="op">)</span>, </span>
<span>     mar <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">4</span>, <span class="fl">1</span>, <span class="fl">1</span>, <span class="fl">4</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rspatial.github.io/terra/reference/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">vancouver</span>, add <span class="op">=</span> <span class="cn">TRUE</span>, col <span class="op">=</span> <span class="st">"black"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rspatial.github.io/terra/reference/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">ds_out_spatial</span>, <span class="st">"MAT"</span>, col <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/grDevices/palettes.html" class="external-link">hcl.colors</a></span><span class="op">(</span><span class="fl">50</span>, palette <span class="op">=</span> <span class="st">"Reds"</span><span class="op">)</span>,</span>
<span>     add <span class="op">=</span> <span class="cn">TRUE</span>, type <span class="op">=</span> <span class="st">"continuous"</span>,</span>
<span>     plg <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>x <span class="op">=</span> <span class="st">"right"</span>, title <span class="op">=</span> <span class="st">"MAT"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rspatial.github.io/terra/reference/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">vancouver_poly</span>, col <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/grDevices/palettes.html" class="external-link">hcl.colors</a></span><span class="op">(</span><span class="fl">50</span>, palette <span class="op">=</span> <span class="st">"Earth"</span><span class="op">)</span>,</span>
<span>     plg <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>x <span class="op">=</span> <span class="st">"bottom"</span>, title <span class="op">=</span> <span class="st">"Elevation"</span><span class="op">)</span>, </span>
<span>     mar <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">4</span>, <span class="fl">1</span>, <span class="fl">1</span>, <span class="fl">4</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rspatial.github.io/terra/reference/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">vancouver</span>, add <span class="op">=</span> <span class="cn">TRUE</span>, col <span class="op">=</span> <span class="st">"black"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rspatial.github.io/terra/reference/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">ds_out_spatial</span>, <span class="st">"PPT"</span>, col <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/grDevices/palettes.html" class="external-link">hcl.colors</a></span><span class="op">(</span><span class="fl">50</span>, palette <span class="op">=</span> <span class="st">"Blues"</span><span class="op">)</span>,</span>
<span>     add <span class="op">=</span> <span class="cn">TRUE</span>, type <span class="op">=</span> <span class="st">"continuous"</span>,</span>
<span>     plg <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>x <span class="op">=</span> <span class="st">"right"</span>, title <span class="op">=</span> <span class="st">"PPT"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="climr_workflow_int_files/figure-html/unnamed-chunk-16-1.png" width="100%" style="display: block; margin: auto;"></p>
</div>
</div>
<div class="section level2">
<h2 id="workflow-with-_input-functions-and-downscale">Workflow with <code>*_input</code> functions and
<code>downscale</code><a class="anchor" aria-label="anchor" href="#workflow-with-_input-functions-and-downscale"></a>
</h2>
<p>Alternatively, a user may choose to run the climate data preparation
and downscaling functions separately.</p>
<p>We suggest doing this at least once or twice to have a full
understanding of the steps that <code>climr_downscale</code> executes
internally.</p>
<p>Steps 1 and 2 bellow download and prepare the climate data used in
the downscaling step (Step 3).</p>
<p>We will use the same point locations as above for downscaling.</p>
<div class="section level3">
<h3 id="get-climate-normals---normal_input">1) Get climate normals - <code>normal_input()</code><a class="anchor" aria-label="anchor" href="#get-climate-normals---normal_input"></a>
</h3>
<p>When using <code><a href="../reference/normal-input-data.html">normal_input()</a></code>, we establish a connection to
the PostGIS server and pass the bounding box containing the point
locations of interest.</p>
<p>There is no “auto” option for to select the source of climate
normals. <code><a href="../reference/data-option-lists.html">list_normal()</a></code> provides a list of available
options:</p>
<ul>
<li><p>‘normal_na’ corresponds to normals for North America obtained
from <a href="climatena.ca">ClimateNA</a> <span class="citation">(<a href="#ref-wang2016" role="doc-biblioref">Wang et al.
2016</a>)</span>;</p></li>
<li><p>‘normal_bc’ corresponds to the British Columbia PRISM
normals;</p></li>
<li><p>‘normal_composite’ corresponds to a composite of British Columbia
PRISM, adjusted US PRISM and DAYMET (Alberta and Saskatchewan), and
covers western Canada and western US.</p></li>
</ul>
<p>We will use ‘normal_composite’ has it is the highest resolution
product for the area of interest.</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/data-option-lists.html">list_normal</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "normal_na"        "normal_bc"        "normal_composite"</span></span></code></pre></div>
<p>The extent of the downloaded climate anomalies will often be larger
than the extent of the bounding box, and vary depending on the spatial
resolution of the data. To demonstrate this we will define a bounding
box with a set of coordinates.</p>
<p>Alternatively, <code>get_bb</code> could be used to extract bounding
box around the point locations in <code>xyzDT</code>.</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">dbCon</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/data_connect.html">data_connect</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">the_bb</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">50</span>, <span class="fl">49</span>, <span class="op">-</span><span class="fl">122</span>, <span class="op">-</span><span class="fl">124</span><span class="op">)</span></span>
<span></span>
<span><span class="co">## alternatively:</span></span>
<span><span class="co"># the_bb &lt;- get_bb(xyzDT)</span></span>
<span></span>
<span><span class="va">normals</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/normal-input-data.html">normal_input</a></span><span class="op">(</span><span class="va">dbCon</span>, bbox <span class="op">=</span> <span class="va">the_bb</span>, </span>
<span>                        normal <span class="op">=</span> <span class="st">"normal_composite"</span><span class="op">)</span></span>
<span><span class="co">#&gt; .</span></span></code></pre></div>
<div class="figure" style="text-align: center">
<img src="climr_workflow_int_files/figure-html/unnamed-chunk-20-1.png" alt="Downloaded normals shown with North Vancouver area and the requested bounding box." width="80%"><p class="caption">
Downloaded normals shown with North Vancouver area and the requested
bounding box.
</p>
</div>
</div>
<div class="section level3">
<h3 id="get-climate-projections-andor-historical-observations">2) Get climate projections and/or historical observations<a class="anchor" aria-label="anchor" href="#get-climate-projections-andor-historical-observations"></a>
</h3>
<p>Data for historic and future climate projections can be obtained with
the <code>gcm_*()</code> functions. <code><a href="../reference/gcm-input-data.html">gcm_hist_input()</a></code> is
used to obtain historical anomalies projected with a (or several) GCM,
whereas <code><a href="../reference/gcm-input-data.html">gcm_input()</a></code> and <code>gcm_ts_input</code> are used
to obtain future anomaly projections for a period or individual years
(i.e. time series).</p>
<p>Historical observations for a given period or for individual years
can be obtained with <code>historic_input</code> and
<code>historic_input_ts</code>, respectively.</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">hist_proj</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/gcm-input-data.html">gcm_hist_input</a></span><span class="op">(</span><span class="va">dbCon</span>, bbox <span class="op">=</span> <span class="va">the_bb</span>, </span>
<span>                            gcm <span class="op">=</span> <span class="st">"EC-Earth3"</span>,</span>
<span>                            years <span class="op">=</span> <span class="fl">2001</span><span class="op">:</span><span class="fl">2020</span>,</span>
<span>                            max_run <span class="op">=</span> <span class="fl">0</span><span class="op">)</span></span>
<span><span class="co">#&gt; .</span></span>
<span></span>
<span><span class="va">fut_proj</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/gcm-input-data.html">gcm_input</a></span><span class="op">(</span><span class="va">dbCon</span>, bbox <span class="op">=</span> <span class="va">the_bb</span>, </span>
<span>                      gcm <span class="op">=</span> <span class="st">"EC-Earth3"</span>,</span>
<span>                      ssp <span class="op">=</span> <span class="st">"ssp245"</span>, </span>
<span>                      period <span class="op">=</span> <span class="st">"2021_2040"</span>,</span>
<span>                      max_run <span class="op">=</span> <span class="fl">0</span><span class="op">)</span></span>
<span><span class="co">#&gt; .</span></span>
<span></span>
<span><span class="va">fut_proj_ts</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/gcm-input-data.html">gcm_ts_input</a></span><span class="op">(</span><span class="va">dbCon</span>, bbox <span class="op">=</span> <span class="va">the_bb</span>, </span>
<span>                            gcm <span class="op">=</span> <span class="st">"EC-Earth3"</span>,</span>
<span>                            ssp <span class="op">=</span> <span class="st">"ssp245"</span>, </span>
<span>                            years <span class="op">=</span> <span class="fl">2021</span><span class="op">:</span><span class="fl">2040</span>,</span>
<span>                            max_run <span class="op">=</span> <span class="fl">0</span><span class="op">)</span></span>
<span><span class="co">#&gt; ...</span></span>
<span></span>
<span><span class="va">hist_obs</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/hist-input-data.html">historic_input</a></span><span class="op">(</span><span class="va">dbCon</span>, bbox <span class="op">=</span> <span class="va">the_bb</span>,</span>
<span>                           period <span class="op">=</span> <span class="st">"2001_2020"</span><span class="op">)</span></span>
<span><span class="va">hist_obs_ts</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/hist-input-data.html">historic_input_ts</a></span><span class="op">(</span><span class="va">dbCon</span>, bbox <span class="op">=</span> <span class="va">the_bb</span>,</span>
<span>                                 years <span class="op">=</span> <span class="fl">2001</span><span class="op">:</span><span class="fl">2020</span><span class="op">)</span></span>
<span><span class="co">#&gt; .</span></span></code></pre></div>
<div class="figure" style="text-align: center">
<img src="climr_workflow_int_files/figure-html/unnamed-chunk-22-1.png" alt="Downloaded historical and future anomalies shown with North Vancouver area and the requested bounding box." width="100%"><p class="caption">
Downloaded historical and future anomalies shown with North Vancouver
area and the requested bounding box.
</p>
</div>
</div>
<div class="section level3">
<h3 id="downscale-and-calculate-actual-values-i-e--not-anomalies">3) Downscale and calculate actual values (i.e., not anomalies)<a class="anchor" aria-label="anchor" href="#downscale-and-calculate-actual-values-i-e--not-anomalies"></a>
</h3>
<p>Now that we have all necessary inputs, we can downscale the climate
data. To avoid repeating the same lines of code for each input, we’ll
use <code><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply()</a></code> and <code><a href="https://rdrr.io/r/base/do.call.html" class="external-link">do.call()</a></code> to iterate over the
several climate inputs to downscale.</p>
<p>Note that for <code><a href="https://rdrr.io/r/base/do.call.html" class="external-link">do.call()</a></code> to work, our list of climate
inputs (<code>inputs</code>) must be named according to
<code><a href="../reference/downscale.html">downscale()</a></code>’s argument names (you can list them with
<code>formalArgs(downscale)</code>).</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">inputs</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="st">"gcm"</span> <span class="op">=</span> <span class="va">fut_proj</span>,</span>
<span>               <span class="st">"historic"</span> <span class="op">=</span> <span class="va">hist_obs</span>,</span>
<span>               <span class="st">"gcm_ts"</span> <span class="op">=</span> <span class="va">fut_proj_ts</span>,</span>
<span>               <span class="st">"gcm_hist"</span> <span class="op">=</span> <span class="va">hist_proj</span>,</span>
<span>               <span class="st">"historic_ts"</span> <span class="op">=</span> <span class="va">hist_obs_ts</span><span class="op">)</span></span>
<span></span>
<span><span class="va">all_downscale</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">sapply</a></span><span class="op">(</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">inputs</span><span class="op">)</span>, </span>
<span>                        <span class="kw">function</span><span class="op">(</span><span class="va">input_arg</span>, <span class="va">xyzDT</span>, <span class="va">normals</span>, <span class="va">inputs</span><span class="op">)</span> <span class="op">{</span></span>
<span>                          <span class="va">args</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">inputs</span><span class="op">[[</span><span class="va">input_arg</span><span class="op">]</span><span class="op">]</span><span class="op">)</span></span>
<span>                          <span class="fu"><a href="https://rspatial.github.io/terra/reference/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">args</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="va">input_arg</span></span>
<span>                          </span>
<span>                          <span class="co">## add a few more arguments</span></span>
<span>                          <span class="va">args</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/append.html" class="external-link">append</a></span><span class="op">(</span><span class="va">args</span>, </span>
<span>                                         <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="st">"xyz"</span> <span class="op">=</span> <span class="va">xyzDT</span>,</span>
<span>                                              <span class="st">"normal"</span> <span class="op">=</span> <span class="va">normals</span>,</span>
<span>                                              <span class="st">"return_normal"</span> <span class="op">=</span> <span class="cn">FALSE</span>, </span>
<span>                                              <span class="st">"vars"</span> <span class="op">=</span> <span class="st">"MAT"</span>, </span>
<span>                                              <span class="st">"out_spatial"</span> <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span><span class="op">)</span></span>
<span>                          </span>
<span>                          <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/do.call.html" class="external-link">do.call</a></span><span class="op">(</span><span class="va">downscale</span>, <span class="va">args</span><span class="op">)</span><span class="op">)</span></span>
<span>                        <span class="op">}</span>, normals <span class="op">=</span> <span class="va">normals</span>, inputs <span class="op">=</span> <span class="va">inputs</span>, <span class="va">xyzDT</span><span class="op">)</span></span>
<span></span>
<span><span class="va">all_downscale</span></span></code></pre></div>
<pre><code><span><span class="co">#&gt; $gcm</span></span>
<span><span class="co">#&gt; Key: &lt;id, GCM, SSP, RUN, PERIOD&gt;</span></span>
<span><span class="co">#&gt;        id       GCM    SSP          RUN    PERIOD       MAT</span></span>
<span><span class="co">#&gt;     &lt;int&gt;    &lt;char&gt; &lt;char&gt;       &lt;char&gt;    &lt;char&gt;     &lt;num&gt;</span></span>
<span><span class="co">#&gt;  1:    87 EC-Earth3 ssp245 ensembleMean 2021_2040 11.241924</span></span>
<span><span class="co">#&gt;  2:   175 EC-Earth3 ssp245 ensembleMean 2021_2040 11.969482</span></span>
<span><span class="co">#&gt;  3:   191 EC-Earth3 ssp245 ensembleMean 2021_2040 10.772463</span></span>
<span><span class="co">#&gt;  4:   208 EC-Earth3 ssp245 ensembleMean 2021_2040 11.903974</span></span>
<span><span class="co">#&gt;  5:   209 EC-Earth3 ssp245 ensembleMean 2021_2040 10.501632</span></span>
<span><span class="co">#&gt; ---                                                        </span></span>
<span><span class="co">#&gt; 84: 12904 EC-Earth3 ssp245 ensembleMean 2021_2040  7.239116</span></span>
<span><span class="co">#&gt; 85: 12905 EC-Earth3 ssp245 ensembleMean 2021_2040  9.616617</span></span>
<span><span class="co">#&gt; 86: 12918 EC-Earth3 ssp245 ensembleMean 2021_2040 11.666369</span></span>
<span><span class="co">#&gt; 87: 12925 EC-Earth3 ssp245 ensembleMean 2021_2040 11.779511</span></span>
<span><span class="co">#&gt; 88: 12936 EC-Earth3 ssp245 ensembleMean 2021_2040 11.949486</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $historic</span></span>
<span><span class="co">#&gt; Key: &lt;id, PERIOD&gt;</span></span>
<span><span class="co">#&gt;        id    PERIOD       MAT</span></span>
<span><span class="co">#&gt;     &lt;int&gt;    &lt;char&gt;     &lt;num&gt;</span></span>
<span><span class="co">#&gt;  1:    87 2001_2020 10.047888</span></span>
<span><span class="co">#&gt;  2:   175 2001_2020 10.784607</span></span>
<span><span class="co">#&gt;  3:   191 2001_2020  9.557805</span></span>
<span><span class="co">#&gt;  4:   208 2001_2020 10.723865</span></span>
<span><span class="co">#&gt;  5:   209 2001_2020  9.311382</span></span>
<span><span class="co">#&gt; ---                          </span></span>
<span><span class="co">#&gt; 84: 12904 2001_2020  6.018799</span></span>
<span><span class="co">#&gt; 85: 12905 2001_2020  8.390223</span></span>
<span><span class="co">#&gt; 86: 12918 2001_2020 10.478055</span></span>
<span><span class="co">#&gt; 87: 12925 2001_2020 10.607733</span></span>
<span><span class="co">#&gt; 88: 12936 2001_2020 10.760592</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $gcm_ts</span></span>
<span><span class="co">#&gt; Key: &lt;id, GCM, SSP, RUN, PERIOD&gt;</span></span>
<span><span class="co">#&gt;          id       GCM    SSP          RUN PERIOD      MAT</span></span>
<span><span class="co">#&gt;       &lt;int&gt;    &lt;char&gt; &lt;char&gt;       &lt;char&gt; &lt;char&gt;    &lt;num&gt;</span></span>
<span><span class="co">#&gt;    1:    87 EC-Earth3 ssp245 ensembleMean   2021 10.98362</span></span>
<span><span class="co">#&gt;    2:    87 EC-Earth3 ssp245 ensembleMean   2022 11.53311</span></span>
<span><span class="co">#&gt;    3:    87 EC-Earth3 ssp245 ensembleMean   2023 11.05650</span></span>
<span><span class="co">#&gt;    4:    87 EC-Earth3 ssp245 ensembleMean   2024 10.78489</span></span>
<span><span class="co">#&gt;    5:    87 EC-Earth3 ssp245 ensembleMean   2025 11.31764</span></span>
<span><span class="co">#&gt;   ---                                                    </span></span>
<span><span class="co">#&gt; 1756: 12936 EC-Earth3 ssp245 ensembleMean   2036 12.10103</span></span>
<span><span class="co">#&gt; 1757: 12936 EC-Earth3 ssp245 ensembleMean   2037 12.00270</span></span>
<span><span class="co">#&gt; 1758: 12936 EC-Earth3 ssp245 ensembleMean   2038 11.70371</span></span>
<span><span class="co">#&gt; 1759: 12936 EC-Earth3 ssp245 ensembleMean   2039 12.63359</span></span>
<span><span class="co">#&gt; 1760: 12936 EC-Earth3 ssp245 ensembleMean   2040 11.83683</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $gcm_hist</span></span>
<span><span class="co">#&gt; Key: &lt;id, GCM, RUN, PERIOD&gt;</span></span>
<span><span class="co">#&gt;         id       GCM          RUN PERIOD      MAT</span></span>
<span><span class="co">#&gt;      &lt;int&gt;    &lt;char&gt;       &lt;char&gt; &lt;char&gt;    &lt;num&gt;</span></span>
<span><span class="co">#&gt;   1:    87 EC-Earth3 ensembleMean   2001 10.37796</span></span>
<span><span class="co">#&gt;   2:    87 EC-Earth3 ensembleMean   2002 10.41935</span></span>
<span><span class="co">#&gt;   3:    87 EC-Earth3 ensembleMean   2003 10.94394</span></span>
<span><span class="co">#&gt;   4:    87 EC-Earth3 ensembleMean   2004 10.71435</span></span>
<span><span class="co">#&gt;   5:    87 EC-Earth3 ensembleMean   2005 10.92751</span></span>
<span><span class="co">#&gt;  ---                                             </span></span>
<span><span class="co">#&gt; 876: 12936 EC-Earth3 ensembleMean   2006 10.97968</span></span>
<span><span class="co">#&gt; 877: 12936 EC-Earth3 ensembleMean   2007 11.42034</span></span>
<span><span class="co">#&gt; 878: 12936 EC-Earth3 ensembleMean   2008 11.00490</span></span>
<span><span class="co">#&gt; 879: 12936 EC-Earth3 ensembleMean   2009 11.11430</span></span>
<span><span class="co">#&gt; 880: 12936 EC-Earth3 ensembleMean   2010 12.07629</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $historic_ts</span></span>
<span><span class="co">#&gt; Key: &lt;id, PERIOD&gt;</span></span>
<span><span class="co">#&gt;          id PERIOD      MAT</span></span>
<span><span class="co">#&gt;       &lt;int&gt; &lt;char&gt;    &lt;num&gt;</span></span>
<span><span class="co">#&gt;    1:    87   2001 10.20435</span></span>
<span><span class="co">#&gt;    2:    87   2002 10.35103</span></span>
<span><span class="co">#&gt;    3:    87   2003 10.81289</span></span>
<span><span class="co">#&gt;    4:    87   2004 11.28643</span></span>
<span><span class="co">#&gt;    5:    87   2005 10.86849</span></span>
<span><span class="co">#&gt;   ---                      </span></span>
<span><span class="co">#&gt; 1756: 12936   2016 12.08256</span></span>
<span><span class="co">#&gt; 1757: 12936   2017 11.26032</span></span>
<span><span class="co">#&gt; 1758: 12936   2018 11.68008</span></span>
<span><span class="co">#&gt; 1759: 12936   2019 11.40181</span></span>
<span><span class="co">#&gt; 1760: 12936   2020 11.52093</span></span></code></pre>
<p>Binding the tables results in a similar table to the one we would
have achieved had we used <code><a href="../reference/climr_downscale.html">climr_downscale()</a></code>.</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">all_downscale</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdatatable.gitlab.io/data.table/reference/rbindlist.html" class="external-link">rbindlist</a></span><span class="op">(</span><span class="va">all_downscale</span>, use.names <span class="op">=</span> <span class="cn">TRUE</span>, fill <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<table class="table">
<caption>‘all_downscale’ table after binding. Outputs are shown for one
location (‘id’)</caption>
<thead><tr class="header">
<th align="right">id</th>
<th align="left">GCM</th>
<th align="left">SSP</th>
<th align="left">RUN</th>
<th align="left">PERIOD</th>
<th align="right">MAT</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="right">87</td>
<td align="left">EC-Earth3</td>
<td align="left">ssp245</td>
<td align="left">ensembleMean</td>
<td align="left">2021_2040</td>
<td align="right">11.241924</td>
</tr>
<tr class="even">
<td align="right">87</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">2001_2020</td>
<td align="right">10.047888</td>
</tr>
<tr class="odd">
<td align="right">87</td>
<td align="left">EC-Earth3</td>
<td align="left">ssp245</td>
<td align="left">ensembleMean</td>
<td align="left">2021</td>
<td align="right">10.983617</td>
</tr>
<tr class="even">
<td align="right">87</td>
<td align="left">EC-Earth3</td>
<td align="left">ssp245</td>
<td align="left">ensembleMean</td>
<td align="left">2022</td>
<td align="right">11.533110</td>
</tr>
<tr class="odd">
<td align="right">87</td>
<td align="left">EC-Earth3</td>
<td align="left">ssp245</td>
<td align="left">ensembleMean</td>
<td align="left">2023</td>
<td align="right">11.056503</td>
</tr>
<tr class="even">
<td align="right">87</td>
<td align="left">EC-Earth3</td>
<td align="left">ssp245</td>
<td align="left">ensembleMean</td>
<td align="left">2024</td>
<td align="right">10.784895</td>
</tr>
<tr class="odd">
<td align="right">87</td>
<td align="left">EC-Earth3</td>
<td align="left">ssp245</td>
<td align="left">ensembleMean</td>
<td align="left">2025</td>
<td align="right">11.317642</td>
</tr>
<tr class="even">
<td align="right">87</td>
<td align="left">EC-Earth3</td>
<td align="left">ssp245</td>
<td align="left">ensembleMean</td>
<td align="left">2026</td>
<td align="right">11.244127</td>
</tr>
<tr class="odd">
<td align="right">87</td>
<td align="left">EC-Earth3</td>
<td align="left">ssp245</td>
<td align="left">ensembleMean</td>
<td align="left">2027</td>
<td align="right">11.659147</td>
</tr>
<tr class="even">
<td align="right">87</td>
<td align="left">EC-Earth3</td>
<td align="left">ssp245</td>
<td align="left">ensembleMean</td>
<td align="left">2028</td>
<td align="right">11.251782</td>
</tr>
<tr class="odd">
<td align="right">87</td>
<td align="left">EC-Earth3</td>
<td align="left">ssp245</td>
<td align="left">ensembleMean</td>
<td align="left">2029</td>
<td align="right">11.023143</td>
</tr>
<tr class="even">
<td align="right">87</td>
<td align="left">EC-Earth3</td>
<td align="left">ssp245</td>
<td align="left">ensembleMean</td>
<td align="left">2030</td>
<td align="right">11.120112</td>
</tr>
<tr class="odd">
<td align="right">87</td>
<td align="left">EC-Earth3</td>
<td align="left">ssp245</td>
<td align="left">ensembleMean</td>
<td align="left">2031</td>
<td align="right">10.860913</td>
</tr>
<tr class="even">
<td align="right">87</td>
<td align="left">EC-Earth3</td>
<td align="left">ssp245</td>
<td align="left">ensembleMean</td>
<td align="left">2032</td>
<td align="right">11.668988</td>
</tr>
<tr class="odd">
<td align="right">87</td>
<td align="left">EC-Earth3</td>
<td align="left">ssp245</td>
<td align="left">ensembleMean</td>
<td align="left">2033</td>
<td align="right">11.560028</td>
</tr>
<tr class="even">
<td align="right">87</td>
<td align="left">EC-Earth3</td>
<td align="left">ssp245</td>
<td align="left">ensembleMean</td>
<td align="left">2034</td>
<td align="right">10.708113</td>
</tr>
<tr class="odd">
<td align="right">87</td>
<td align="left">EC-Earth3</td>
<td align="left">ssp245</td>
<td align="left">ensembleMean</td>
<td align="left">2035</td>
<td align="right">11.344805</td>
</tr>
<tr class="even">
<td align="right">87</td>
<td align="left">EC-Earth3</td>
<td align="left">ssp245</td>
<td align="left">ensembleMean</td>
<td align="left">2036</td>
<td align="right">11.391718</td>
</tr>
<tr class="odd">
<td align="right">87</td>
<td align="left">EC-Earth3</td>
<td align="left">ssp245</td>
<td align="left">ensembleMean</td>
<td align="left">2037</td>
<td align="right">11.295037</td>
</tr>
<tr class="even">
<td align="right">87</td>
<td align="left">EC-Earth3</td>
<td align="left">ssp245</td>
<td align="left">ensembleMean</td>
<td align="left">2038</td>
<td align="right">10.984661</td>
</tr>
<tr class="odd">
<td align="right">87</td>
<td align="left">EC-Earth3</td>
<td align="left">ssp245</td>
<td align="left">ensembleMean</td>
<td align="left">2039</td>
<td align="right">11.928165</td>
</tr>
<tr class="even">
<td align="right">87</td>
<td align="left">EC-Earth3</td>
<td align="left">ssp245</td>
<td align="left">ensembleMean</td>
<td align="left">2040</td>
<td align="right">11.121972</td>
</tr>
<tr class="odd">
<td align="right">87</td>
<td align="left">EC-Earth3</td>
<td align="left">NA</td>
<td align="left">ensembleMean</td>
<td align="left">2001</td>
<td align="right">10.377962</td>
</tr>
<tr class="even">
<td align="right">87</td>
<td align="left">EC-Earth3</td>
<td align="left">NA</td>
<td align="left">ensembleMean</td>
<td align="left">2002</td>
<td align="right">10.419348</td>
</tr>
<tr class="odd">
<td align="right">87</td>
<td align="left">EC-Earth3</td>
<td align="left">NA</td>
<td align="left">ensembleMean</td>
<td align="left">2003</td>
<td align="right">10.943936</td>
</tr>
<tr class="even">
<td align="right">87</td>
<td align="left">EC-Earth3</td>
<td align="left">NA</td>
<td align="left">ensembleMean</td>
<td align="left">2004</td>
<td align="right">10.714349</td>
</tr>
<tr class="odd">
<td align="right">87</td>
<td align="left">EC-Earth3</td>
<td align="left">NA</td>
<td align="left">ensembleMean</td>
<td align="left">2005</td>
<td align="right">10.927514</td>
</tr>
<tr class="even">
<td align="right">87</td>
<td align="left">EC-Earth3</td>
<td align="left">NA</td>
<td align="left">ensembleMean</td>
<td align="left">2006</td>
<td align="right">10.266208</td>
</tr>
<tr class="odd">
<td align="right">87</td>
<td align="left">EC-Earth3</td>
<td align="left">NA</td>
<td align="left">ensembleMean</td>
<td align="left">2007</td>
<td align="right">10.704759</td>
</tr>
<tr class="even">
<td align="right">87</td>
<td align="left">EC-Earth3</td>
<td align="left">NA</td>
<td align="left">ensembleMean</td>
<td align="left">2008</td>
<td align="right">10.300014</td>
</tr>
<tr class="odd">
<td align="right">87</td>
<td align="left">EC-Earth3</td>
<td align="left">NA</td>
<td align="left">ensembleMean</td>
<td align="left">2009</td>
<td align="right">10.407530</td>
</tr>
<tr class="even">
<td align="right">87</td>
<td align="left">EC-Earth3</td>
<td align="left">NA</td>
<td align="left">ensembleMean</td>
<td align="left">2010</td>
<td align="right">11.369159</td>
</tr>
<tr class="odd">
<td align="right">87</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">2001</td>
<td align="right">10.204346</td>
</tr>
<tr class="even">
<td align="right">87</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">2002</td>
<td align="right">10.351032</td>
</tr>
<tr class="odd">
<td align="right">87</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">2003</td>
<td align="right">10.812891</td>
</tr>
<tr class="even">
<td align="right">87</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">2004</td>
<td align="right">11.286425</td>
</tr>
<tr class="odd">
<td align="right">87</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">2005</td>
<td align="right">10.868485</td>
</tr>
<tr class="even">
<td align="right">87</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">2006</td>
<td align="right">10.682606</td>
</tr>
<tr class="odd">
<td align="right">87</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">2007</td>
<td align="right">10.167580</td>
</tr>
<tr class="even">
<td align="right">87</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">2008</td>
<td align="right">9.816912</td>
</tr>
<tr class="odd">
<td align="right">87</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">2009</td>
<td align="right">10.253012</td>
</tr>
<tr class="even">
<td align="right">87</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">2010</td>
<td align="right">10.693474</td>
</tr>
<tr class="odd">
<td align="right">87</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">2011</td>
<td align="right">9.691577</td>
</tr>
<tr class="even">
<td align="right">87</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">2012</td>
<td align="right">10.268910</td>
</tr>
<tr class="odd">
<td align="right">87</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">2013</td>
<td align="right">10.829844</td>
</tr>
<tr class="even">
<td align="right">87</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">2014</td>
<td align="right">11.178109</td>
</tr>
<tr class="odd">
<td align="right">87</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">2015</td>
<td align="right">11.961115</td>
</tr>
<tr class="even">
<td align="right">87</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">2016</td>
<td align="right">11.375838</td>
</tr>
<tr class="odd">
<td align="right">87</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">2017</td>
<td align="right">10.569581</td>
</tr>
<tr class="even">
<td align="right">87</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">2018</td>
<td align="right">10.983173</td>
</tr>
<tr class="odd">
<td align="right">87</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">2019</td>
<td align="right">10.718506</td>
</tr>
<tr class="even">
<td align="right">87</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">2020</td>
<td align="right">10.831819</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section level2 unnumbered">
<h2 class="unnumbered" id="references">References<a class="anchor" aria-label="anchor" href="#references"></a>
</h2>
<div id="refs" class="references csl-bib-body hanging-indent">
<div id="ref-wang2016" class="csl-entry">
Wang, Tongli, Andreas Hamann, Dave Spittlehouse, and Carlos Carroll.
2016. <span>“Locally Downscaled and Spatially Customizable Climate Data
for Historical and Future Periods for North America.”</span> Edited by
Inés Álvarez. <em>PLOS ONE</em> 11 (6): e0156720. <a href="https://doi.org/10.1371/journal.pone.0156720" class="external-link">https://doi.org/10.1371/journal.pone.0156720</a>.
</div>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by Kiri Daust, Colin Mahony, Bruno Tremblay, Ceres Barros, Province of British Columbia.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
