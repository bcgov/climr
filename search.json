[{"path":"https://bcgov.github.io/climr/articles/climr_with_rasters.html","id":"spatial-inputs-and-climr_downscale","dir":"Articles","previous_headings":"","what":"Spatial inputs and climr_downscale()","title":"Working with rasters and other spatial objects","text":"often start spatial object study area (raster vector format) point locations want obtain downscaled climate variables. Bellow show work spatial objects climr_downscale().","code":""},{"path":"https://bcgov.github.io/climr/articles/climr_with_rasters.html","id":"raster-inputs","dir":"Articles","previous_headings":"Spatial inputs and climr_downscale()","what":"Raster inputs","title":"Working with rasters and other spatial objects","text":"Often raster interest study area want full coverage downscaled climate variables. Since climr_downscale() accepts table point locations, need convert raster table cell coordinates, elevation (‘elev’) information unique point IDs.","code":""},{"path":"https://bcgov.github.io/climr/articles/climr_with_rasters.html","id":"raster-with-elevation-values-a-dem","dir":"Articles","previous_headings":"Spatial inputs and climr_downscale() > Raster inputs","what":"Raster with elevation values (a DEM)","title":"Working with rasters and other spatial objects","text":"raster DEM, points SpatVector inherits elevation cell values. DEM use 0 elevation values ocean areas. Since climr meant used downscale climate variables land, “clip” (set values outside polygon NAs) raster using land-polygon. Digital Elevation Model North Vancouver w/ w/o values outside polygon area making table raster cell (centroid) coordinates must preserve cell IDs (.data.frame(..., cell = TRUE)) can later convert clirm_downscale() outputs back raster format. Note cells NA’s automagically excluded. can now pass table cell locations climr_downscale(): convert outputs back raster format, simply need use original raster use extract point locations template make rasters downscaled climate values. Since location ids match raster cell IDs, dwscl_out$id column used index raster cells climate values assigning downscaled MAT values. climr_downscale() outputs converted raster layers","code":"library(climr) library(terra) library(data.table)  dem_vancouver <- get(data(\"dem_vancouver\")) |>   unwrap()  vancouver_poly <- get(data(\"vancouver_poly\")) |>   unwrap()  dem_vancouver <- mask(dem_vancouver, vancouver_poly) ## xy = TRUE ensures we get cell (centroid) coordinates ## cell = TRUE ensures we get cell ID numbers, which will be the point location IDs. xyzDT <- dem_vancouver |>   as.data.frame(., xy = TRUE, cell = TRUE) |>   as.data.table()  ## rename colums to climr standard setnames(xyzDT, c(\"id\", \"lon\", \"lat\", \"elev\")) xyzDT #>            id       lon      lat      elev #>         <num>     <num>    <num>     <num> #>     1:     62 -123.2486 49.49944  16.22222 #>     2:     63 -123.2478 49.49944  39.88889 #>     3:     64 -123.2469 49.49944  81.22222 #>     4:     65 -123.2461 49.49944 139.11111 #>     5:     66 -123.2453 49.49944 179.77777 #>    ---                                     #> 94025: 115196 -122.9036 49.30028 112.44444 #> 94026: 115197 -122.9028 49.30028 116.44444 #> 94027: 115198 -122.9019 49.30028 128.00000 #> 94028: 115199 -122.9011 49.30028 133.33333 #> 94029: 115200 -122.9003 49.30028 136.88889 ## in this case there's really no need for a spatial output format dwscl_out <- climr_downscale(xyzDT,   which_normal = \"auto\",   gcm_models = list_gcm()[1],   ssp = list_ssp()[1],   gcm_period = list_gcm_period(),   max_run = 0L, return_normal = FALSE,   vars = \"MAT\", out_spatial = FALSE ) tempRas <- rast(dem_vancouver)  dwscl_Ras <- sapply(split(dwscl_out, by = c(\"GCM\", \"PERIOD\")), function(DT, tempRas) {   tempRas[DT$id] <- DT$MAT   return(tempRas) }, tempRas = tempRas)  ## make a stack dwscl_Ras <- rast(dwscl_Ras)  dwscl_Ras #> class       : SpatRaster  #> dimensions  : 240, 480, 5  (nrow, ncol, nlyr) #> resolution  : 0.0008333333, 0.0008333333  (x, y) #> extent      : -123.2999, -122.8999, 49.29986, 49.49986  (xmin, xmax, ymin, ymax) #> coord. ref. : lon/lat WGS 84 (EPSG:4326)  #> source(s)   : memory #> names       : ACCESS~1_2020, ACCESS~1_2040, ACCESS~1_2060, ACCESS~1_2080, ACCESS~1_2100  #> min values  :      3.011241,      4.083216,      4.864598,      5.315447,      5.305784  #> max values  :     11.770973,     12.841200,     13.613663,     14.062831,     14.053918"},{"path":"https://bcgov.github.io/climr/articles/climr_with_rasters.html","id":"raster-without-elevation-values","dir":"Articles","previous_headings":"Spatial inputs and climr_downscale() > Raster inputs","what":"Raster without elevation values","title":"Working with rasters and other spatial objects","text":"raster DEM, need obtain elevation points extracted raster cells. can done extracting elevation values DEM raster first raster’s cell centroid coordinates. DEM’s resolution doesn’t need match first raster’s resolution. start raster biogeoclimatc zones North Vancouver use lower resolution DEM obtain elevation values. , clip land areas. Rasters used derive point locations (left) elevation values (right). process convert downscaled data raster format , used raster cell IDs point location IDs (xyzDT$id):","code":"## get point locations from raster of interest BECz_vancouver_ras <- get(data(\"BECz_vancouver_ras\")) |>   unwrap()  BECz_vancouver_ras <- mask(BECz_vancouver_ras, vancouver_poly)  ## raster to data.table and rename columns to climr standard xyzDT <- BECz_vancouver_ras |>   as.data.frame(., xy = TRUE, cell = TRUE) |>   as.data.table() setnames(xyzDT, c(\"id\", \"lon\", \"lat\", \"ZONE\"))  ## now extract elevation values at each cell centroid coordinate ## from a DEM raster dem_vancouver_lowres <- get(data(dem_vancouver_lowres)) |>   unwrap()  xyzDT$elev <- extract(dem_vancouver_lowres, xyzDT[, .(lon, lat)])[names(dem_vancouver_lowres)] par(mfrow = c(1, 2)) plot(BECz_vancouver_ras, main = \"BGC zones N Vancouver\") plot(dem_vancouver_lowres,   main = \"Low res. DEM\",   col = hcl.colors(100, \"Earth\") ) par(mfrow = c(1, 1)) dwscl_out <- climr_downscale(xyzDT,   which_normal = \"auto\",   gcm_models = list_gcm()[1],   ssp = list_ssp()[1],   gcm_period = list_gcm_period(),   max_run = 0L, return_normal = FALSE,   vars = \"MAT\", out_spatial = FALSE )  tempRas <- rast(BECz_vancouver_ras)  dwscl_Ras <- sapply(split(dwscl_out, by = c(\"GCM\", \"PERIOD\")), function(DT, tempRas) {   tempRas[DT$id] <- DT$MAT   return(tempRas) }, tempRas = tempRas)  ## make a stack dwscl_Ras <- rast(dwscl_Ras)"},{"path":"https://bcgov.github.io/climr/articles/climr_with_rasters.html","id":"lowering-an-input-raster-resolution","dir":"Articles","previous_headings":"Spatial inputs and climr_downscale() > Raster inputs","what":"Lowering an input raster resolution","title":"Working with rasters and other spatial objects","text":"may want downscale climate coarser resolution , e.g., DEM raster layer hand: Points extracted raster , pass data.table point locations climr_downscale: Plot spatial outputs climr_downscale() using spaced point locations","code":"vancouver_poly <- get(data(\"vancouver_poly\")) |>   unwrap() dem_vancouver <- get(data(\"dem_vancouver\")) |>   unwrap()  dem_vancouver <- mask(dem_vancouver, vancouver_poly)  ## extract points at a coarser scale, but elevation at original scale lowRes_ras <- rast(dem_vancouver) lowRes_ras <- project(lowRes_ras, crs(lowRes_ras), res = 0.01)  lowRes_ras[] <- 1 lowRes_ras <- mask(lowRes_ras, vancouver_poly) ## set water back to NA  lowRes_points <- as.points(lowRes_ras) lowRes_points$id <- 1:nrow(lowRes_points)  xyzDT <- extract(dem_vancouver, lowRes_points, xy = TRUE) |>   as.data.table() setnames(xyzDT, c(\"id\", \"elev\", \"lon\", \"lat\"))  ## exclude NAs xyzDT <- xyzDT[complete.cases(xyzDT)] lowRes_points <- lowRes_points[lowRes_points$id %in% xyzDT$id, ] dwscl_out <- climr_downscale(xyzDT,   which_normal = \"auto\",   gcm_models = list_gcm()[1],   ssp = list_ssp()[1],   gcm_period = list_gcm_period(),   max_run = 0L, return_normal = FALSE,   vars = \"MAT\", out_spatial = TRUE )"},{"path":[]},{"path":"https://bcgov.github.io/climr/articles/climr_with_rasters.html","id":"point-vector-data","dir":"Articles","previous_headings":"Spatial inputs and climr_downscale() > Vector inputs/outputs","what":"Point vector data","title":"Working with rasters and other spatial objects","text":"process similar . points elevation information simply need convert data.table. case, point IDs need added data.table afterwards. don’t elevation information, need obtain . example start set points North Vancouver, BC, Canada, get elevation values Digital Elevation Model (DEM) raster. terra::extract() function outputs data.frame point IDs, extracted values , optionally x/y coordinates. need simply use output create xyzDT table climr_downscale(). get point-type outputs simply set climr_downscale(..., out_spatial = TRUE). Plot spatial outputs climr_downscale()","code":"vancouver_points <- get(data(\"vancouver_points\")) |>   unwrap() dem_vancouver <- get(data(\"dem_vancouver\")) |>   unwrap()  xyzDT <- extract(dem_vancouver, vancouver_points, xy = TRUE) |>   as.data.table() setnames(xyzDT, c(\"id\", \"elev\", \"lon\", \"lat\"))  dwscl_out <- climr_downscale(xyzDT,   which_normal = \"auto\",   gcm_models = list_gcm()[1],   ssp = list_ssp()[1],   gcm_period = list_gcm_period(),   vars = \"MAT\", max_run = 0L,   return_normal = FALSE,   out_spatial = TRUE ) dwscl_out #>  class       : SpatVector  #>  geometry    : points  #>  dimensions  : 5000, 7  (geometries, attributes) #>  extent      : -123.2828, -122.9003, 49.30028, 49.49944  (xmin, xmax, ymin, ymax) #>  coord. ref. : +proj=longlat +datum=WGS84 +no_defs  #>  names       :  elev    id           GCM    SSP          RUN    PERIOD   MAT #>  type        : <num> <num>         <chr>  <chr>        <chr>     <chr> <num> #>  values      : 233.1     1 ACCESS-ESM1-5 ssp126 ensembleMean 2001_2020 10.32 #>                233.1     1 ACCESS-ESM1-5 ssp126 ensembleMean 2021_2040 11.39 #>                233.1     1 ACCESS-ESM1-5 ssp126 ensembleMean 2041_2060 12.16"},{"path":"https://bcgov.github.io/climr/articles/climr_with_rasters.html","id":"polygon-vector-data","dir":"Articles","previous_headings":"Spatial inputs and climr_downscale()","what":"Polygon vector data","title":"Working with rasters and other spatial objects","text":"assume polygon data refers area (several) want downscaled climate variables . polygon associated single value per attribute field, polygons need sampled/combined points downscaling happen. examples showed use polygon mask raster points dataset creating xyzDT table, way achieve . , show another example points derived polygon centroids.","code":""},{"path":"https://bcgov.github.io/climr/articles/climr_with_rasters.html","id":"using-polygon-centroids","dir":"Articles","previous_headings":"Spatial inputs and climr_downscale() > Polygon vector data","what":"using polygon centroids","title":"Working with rasters and other spatial objects","text":"advise unless polygons small centroid reflects overall polygon’s climate conditions. Excluded (grey) retained (blue) polygon centroids","code":"vancouver_poly <- get(data(\"vancouver_poly\")) |>   unwrap() dem_vancouver <- get(data(\"dem_vancouver\")) |>   unwrap()  centrds <- centroids(vancouver_poly, inside = TRUE)  ## get polygon areas and exclude very large polygon centroids centrds$area <- expanse(vancouver_poly) centrds <- centrds[centrds$area < 50000, ]  ## we retained only 3 points  xyzDT <- extract(dem_vancouver, centrds, xy = TRUE) |>   as.data.table() setnames(xyzDT, c(\"id\", \"elev\", \"lon\", \"lat\"))  dwscl_outGrid <- climr_downscale(xyzDT,   which_normal = \"auto\",   gcm_models = list_gcm()[1],   ssp = list_ssp()[1],   gcm_period = list_gcm_period(),   max_run = 0L, return_normal = FALSE,   vars = \"MAT\", out_spatial = TRUE )"},{"path":[]},{"path":"https://bcgov.github.io/climr/articles/climr_workflow_beg.html","id":"using-the-climr_downscale-function","dir":"Articles","previous_headings":"","what":"Using the climr_downscale() function","title":"Beginner `climr` workflow","text":"basic use climr pass data.table point coordinates, IDs elevation climr_downscale() select type climate projection values wanted - e.g. ask future projections two periods, using two emissions scenarios two General Circulation Models. also specify want 3 individual runs model/scenario combination, addition ensemble mean (returned default). resulting output data.table, printed : ‘ds_out’ table - Output climr_downscale. Outputs shown one location (‘id’)","code":"library(climr)  ## provide a data.frame or data.table of point coordinates, IDs and elevation my_points <- data.frame(   lon = c(-123.4404, -123.5064, -124.2317),   lat = c(48.52631, 48.46807, 49.21999),   elev = c(52, 103, 357),   id = LETTERS[1:3] )  ## climr query for the data.frame ds_out <- climr_downscale(   xyz = my_points, which_normal = \"auto\",   gcm_models = c(\"GFDL-ESM4\", \"EC-Earth3\"), # specify two global climate models   ssp = c(\"ssp370\", \"ssp245\"), # specify two greenhouse gas concentration scenarios   gcm_period = c(\"2001_2020\", \"2041_2060\"), # specify two 20-year periods   max_run = 3, # specify 3 individual runs for each model   vars = c(\"PPT\", \"CMD\", \"CMI\") ) #> ..."},{"path":"https://bcgov.github.io/climr/articles/climr_workflow_beg.html","id":"listing-available-options","dir":"Articles","previous_headings":"","what":"Listing available options","title":"Beginner `climr` workflow","text":"list_* functions (see ?list_gcm) useful see available options, example: functions can used arguments climr_downscale(). example, vars = list_variables() specified obtain data available variables, gcm_models = list_gcm()[c(1,4,5,6,7,10,11,12)] used specify eight-gcm ensemble recommended Mahony et al. (2022).","code":"list_gcm() #>  [1] \"ACCESS-ESM1-5\" \"BCC-CSM2-MR\"   \"CanESM5\"       \"CNRM-ESM2-1\"   #>  [5] \"EC-Earth3\"     \"GFDL-ESM4\"     \"GISS-E2-1-G\"   \"INM-CM5-0\"     #>  [9] \"IPSL-CM6A-LR\"  \"MIROC6\"        \"MPI-ESM1-2-HR\" \"MRI-ESM2-0\"    #> [13] \"UKESM1-0-LL\" list_gcm_period() #> [1] \"2001_2020\" \"2021_2040\" \"2041_2060\" \"2061_2080\" \"2081_2100\" list_ssp() #> [1] \"ssp126\" \"ssp245\" \"ssp370\" \"ssp585\""},{"path":"https://bcgov.github.io/climr/articles/climr_workflow_beg.html","id":"working-with-raster-data","dir":"Articles","previous_headings":"","what":"Working with raster data","title":"Beginner `climr` workflow","text":"common use climr obtain climate data user-provided raster grid. sample code showing . convert digital elevation model (DEM) table points (one per grid cell) use climr input table. take climr input populate raster grid climate variable.  See vignette(\"vignettes/climr_with_rasters.Rmd\") details using climr rasters spatial data.","code":"library(terra) library(data.table)  ## get the sample digital elevation model (dem) provided with `climr` dem_vancouver <- get(data(\"dem_vancouver\")) |>    unwrap()  ## convert the DEM to a data.frame my_grid <- as.data.frame(dem_vancouver, cells = TRUE, xy = TRUE) colnames(my_grid) <- c(\"id\", \"lon\", \"lat\", \"elev\") # rename column names to what climr expects  ## A simple climr query. This will return the observed 1961-1990 and 2001-2020 mean annual temperature (MAT) for the raster grid points.  ds_out <- climr_downscale(   xyz = my_grid,    historic_period = \"2001_2020\",    vars = c(\"MAT\") ) #> .  ## populate the raster grid with the downscaled climate values my_clim <- rast(dem_vancouver) # use the DEM as a template raster my_clim[ds_out[PERIOD == \"2001_2020\", id]] <- ds_out[PERIOD == \"2001_2020\", MAT] # populate the raster cells with the 2001-2020 mean annual temperature (MAT) values, using the `id` field as the link.   plot(my_clim, main = \"2001-2020 mean annual temperature (MAT)\")"},{"path":"https://bcgov.github.io/climr/articles/climr_workflow_beg.html","id":"looking-under-the-hood","dir":"Articles","previous_headings":"","what":"Looking under the hood","title":"Beginner `climr` workflow","text":"can download investigate raw data climr uses downscaling, reference climatological maps, observational time series, GCM anomalies. See section “Workflow *_input functions downscale” vignette(\"vignettes/climr_workflow_int.Rmd\") example.","code":""},{"path":"https://bcgov.github.io/climr/articles/climr_workflow_int.html","id":"introduction","dir":"Articles","previous_headings":"","what":"Introduction","title":"Intermediate `climr` workflow","text":"climr essence similar ClimateNA downscales low-resolution (~100km) global climate model anomalies high-resolution (1-4km) maps climate, elevation adjustment user-specified elevation grids/points based empirical lapse rates (local relationship climate elevation) 1-4km climate maps. elevation-adjusted monthly values basic climate elements (temperature precipitation) used estimate derived variables (e.g., degree-days, precipitation snow) based published equations parameters (Wang et al. 2016). See vignette(\"methods_downscaling.Rmd\") detailed explanation downscaling methodology employed climr. climr’s strenghts : ability obtain multiple, individual runs (several) General Circulation Model(s) (GCM), well ensemble cross-run mean, cloud-based raw data access local data caching, direct R interface downscaled climate elements derived variables covering western Canada western US. vignette cover two basic climr workflows obtain historic future climate projections derived variables. first, less code-heavy, workflow uses climr_downscale() much heavy lifting – [Workflow climr_downscale]. second workflow step--step breakdown climr_downscale() using functions climr_downscale() calls internally – [Workflow *_input functions downscale].","code":""},{"path":"https://bcgov.github.io/climr/articles/climr_workflow_int.html","id":"main-functions","dir":"Articles","previous_headings":"","what":"Main functions","title":"Intermediate `climr` workflow","text":"list main functions used two workflows. climr_downscale() takes data.table point coordinates (lat-long projection), obtains climate normals historic /future projections covering extent points, downscaled using point elevation data used calculate derived climate variables point locations. outputs downscaled derived variables form data.table SpatVector points. normal_input() downloads prepares high-resolution climate normals. Called internally climr_downscale(). historic_input() historic_input_ts() download prepare low-resolution historic climate elements given historic period time series, respectively. Called internally climr_downscale(). gcm_input(), gcm_hist_input() gcm_ts_input() download prepare low-resolution climate element projections future period, historic period future time series, respectively. Called internally climr_downscale(). downscale() downscales historic future climate elements calculates derived climate variables. Called climr_downscale().","code":""},{"path":"https://bcgov.github.io/climr/articles/climr_workflow_int.html","id":"workflow-with-climr_downscale","dir":"Articles","previous_headings":"","what":"Workflow with climr_downscale","title":"Intermediate `climr` workflow","text":"example workflow use climr_downscale() calculate mean annual temperature (MAT), total annual precipitation (PPT) precipitation snow (PAS) weather stations associated Adjusted homogenized Canadian climate data. downscale MAT, PPT MAS locations historic future period, using two separate runs GCM one emissions scenario. begin loading Adjusted Precipitation Canada (APC2) dataset clipping North Vancouver area. dataset already contains elevation information. Note longitude (‘lon’) latitude (‘lat’) must lat-long projection (EPSG:4326) elevation m. Point IDs must unique – use weather station IDs. also add two columns data.table (‘ZONE’ ‘HEZ’) ignored climr_downscale(). climr_downscale() preserves IDs use join back extra columns used plotting later . Weather stations North Vancouver list_*() functions provide list available historic future periods, GCMs, emissions scenarios, derived variables (case annual ones). chose available historic period (2001-2020), 2021-2040 future period, ‘EC-Earth3’ GCM SSP 2.45 scenario. MAT, PPT PAS selected output variables. pass choices climr_downscale(), choosing “auto” normals option (defaults using highest resolution data available points selected). Note data historical periods doesn’t GCM SSP value – expected , GCMs SSPs used project future climate values. Also, future projections obtained two runs EC-Earth3 (‘r1i1p1f1’ ‘r10i1p1f1’), plus ensemble mean. ‘ds_out’ table - Output climr_downscale. Outputs show one location (‘id’) add back extra columns need simple left join. can now simple visualisation climate variation biogeoclimatic zone (‘ZONE’), normals period 1961-1990:  may also want yearly climate projections. case, want yearly values MAT PPT 2001-2015 2021:2040, using GCM, SSP number model runs. Notice data doesn’t need downloaded , retrieved cache. climr_downscale() internally rescales projected historical values align observed counterpart. See vignette(\"methods_downscaling.Rmd\") details. plot time series, filter data single model run (.e. case discard ensemble means) single point location. Note plot observed (obs_hist) projected historical (proj_hist) climate values along future climate projections (proj_fut). Time series outputs climr_downscale. Pannels show mean annual temperature (MAT), total annual precipitation (PPT) precipitation snow (PAS). Line colours refer observed historic values (grey), projected historic values (gren) future projected values (blue) single location, GCM, emissions scenario model run.","code":"library(climr) library(data.table) library(terra)  ## weather station locations weather_stations <- get(data(\"weather_stations\")) |>   unwrap()  ## study area of interest (North Vancouver) vancouver_poly <- get(data(\"vancouver_poly\")) |>   unwrap()  ## subset to points in study area weather_stations <- mask(weather_stations, vancouver_poly)  ## convert to data.table and subset/rename columns needed by climr xyzDT <- as.data.table(weather_stations, geom = \"XY\") cols <- c(\"Station ID\", \"x\", \"y\", \"Elevation (m)\") xyzDT <- xyzDT[, ..cols] setnames(xyzDT, c(\"id\", \"lon\", \"lat\", \"elev\"))  ## join BEC zones and colours BECz_vancouver <- get(data(\"BECz_vancouver\")) |>   unwrap()  BECz_points <- extract(BECz_vancouver, weather_stations) |>   as.data.table() BECz_points <- BECz_points[, .(ZONE, HEX)]  xyzDT <- cbind(xyzDT, BECz_points)  ## remove duplicates xyzDT <- unique(xyzDT)  ## there are some duplicate stations with slightly different ## coordinates. We'll take the first xyzDT <- xyzDT[!duplicated(id)] list_historic() #> [1] \"2001_2020\" list_gcm_period() #> [1] \"2001_2020\" \"2021_2040\" \"2041_2060\" \"2061_2080\" \"2081_2100\" list_gcm() #>  [1] \"ACCESS-ESM1-5\" \"BCC-CSM2-MR\"   \"CanESM5\"       \"CNRM-ESM2-1\"   #>  [5] \"EC-Earth3\"     \"GFDL-ESM4\"     \"GISS-E2-1-G\"   \"INM-CM5-0\"     #>  [9] \"IPSL-CM6A-LR\"  \"MIROC6\"        \"MPI-ESM1-2-HR\" \"MRI-ESM2-0\"    #> [13] \"UKESM1-0-LL\" list_ssp() #> [1] \"ssp126\" \"ssp245\" \"ssp370\" \"ssp585\" list_variables(set = \"Annual\") #>  [1] \"AHM\"   \"bFFP\"  \"CMD\"   \"CMI\"   \"DD_0\"  \"DD_18\" \"DD18\"  \"DD5\"   \"eFFP\"  #> [10] \"EMT\"   \"Eref\"  \"EXT\"   \"FFP\"   \"MAP\"   \"MAT\"   \"MCMT\"  \"MSP\"   \"MWMT\"  #> [19] \"NFFD\"  \"PAS\"   \"PPT\"   \"RH\"    \"SHM\"   \"Tave\"  \"TD\"    \"Tmax\"  \"Tmin\" ds_out <- climr_downscale(   xyz = xyzDT,   which_normal = \"auto\",   historic_period = \"2001_2020\",   gcm_period = \"2021_2040\",   gcm_models = \"EC-Earth3\",   ssp = \"ssp245\",   max_run = 2,   return_normal = TRUE, ## to return the 1961-1990 normals period   vars = c(\"MAT\", \"PPT\", \"PAS\") ) #> Welcome to climr! #> Getting normals... #> Downloading new data... #> . #> Caching data... #> Getting historic... #> Downloading historic anomalies #> . #> Caching data... #> Getting GCMs... #> Downloading GCM anomalies #> . #> Caching data... #> Downscaling!! ds_out <- xyzDT[, .(id, ZONE, HEX)][ds_out, on = .(id)] plotdata <- melt(ds_out, measure.vars = c(\"MAT\", \"PPT\", \"PAS\")) cols <- plotdata$HEX names(cols) <- plotdata$ZONE cols <- cols[!duplicated(cols)]  ggplot(plotdata[PERIOD == \"1961_1990\"], aes(x = ZONE, y = value, fill = ZONE)) +   geom_boxplot() +   theme_light() +   scale_fill_manual(values = cols) +   facet_wrap(~variable, scales = \"free\") ds_out_ts <- climr_downscale(   xyz = xyzDT,   which_normal = \"auto\",   historic_ts = 2001:2015, ## currently up to 2015   gcm_hist_years = 2001:2020, ## currently up to 2010   gcm_ts_years = 2021:2040, ## currently starting at 2021   gcm_models = \"EC-Earth3\",   ssp = \"ssp245\",   max_run = 1,   return_normal = TRUE, ## to return the 1961-1990 normals period   vars = c(\"MAT\", \"PPT\", \"PAS\") ) #> Welcome to climr! #> Getting normals... #> Retrieving from cache... #> Downloading historic anomalies #> . #> Caching data... #> Downloading GCM anomalies #> Precip... #> . #> Tmax... #> . #> Tmin... #> . #> Caching data... #> Downloading GCM anomalies #> . #> Caching data... #> Downscaling!! ds_out_ts[is.na(GCM), GCM := \"Historic\"] ds_out_ts <- ds_out_ts[!grepl(\"ensemble\", RUN)] ds_out_ts <- ds_out_ts[!grepl(\"1961_1990\", PERIOD)]  plotdata <- melt(ds_out_ts, measure.vars = c(\"MAT\", \"PPT\", \"PAS\")) plotdata[, PERIOD := as.numeric(PERIOD)] plotdata <- plotdata[id == head(id, 1)]  ## time series period groupings plotdata[GCM == \"Historic\", pgrp := \"obs_hist\"] plotdata[GCM != \"Historic\" & PERIOD <= 2020, pgrp := \"proj_hist\"] plotdata[GCM != \"Historic\" & PERIOD > 2020, pgrp := \"proj_fut\"]  ## make groups so that missing data is not shown as a \"line connection\" groups <- data.table(PERIOD = unique(plotdata$PERIOD)) groups[, idx := c(1, diff(PERIOD))] i2 <- c(1, which(groups$idx != 1), nrow(groups) + 1) groups[, grp := rep(1:length(diff(i2)), diff(i2))] plotdata <- groups[, .(PERIOD, grp)][plotdata, on = \"PERIOD\"] plotdata[, grp := paste(grp, variable, sep = \"_\")]  yrbreaks <- c(   min(plotdata$PERIOD),   seq(min(plotdata$PERIOD), max(plotdata$PERIOD), by = 5),   max(plotdata$PERIOD) ) |>   unique()  ggplot(plotdata, aes(x = PERIOD, y = value, col = pgrp, group = grp)) +   geom_line(     data = plotdata[pgrp == \"obs_hist\"], size = 1.1,     linejoin = \"round\", lineend = \"round\"   ) +   geom_line(     data = plotdata[pgrp != \"obs_hist\"], size = 1.1,     linejoin = \"round\", lineend = \"round\"   ) +   scale_x_continuous(breaks = yrbreaks, labels = yrbreaks) +   scale_color_manual(     values = c(       \"obs_hist\" = \"grey\",       \"proj_hist\" = \"forestgreen\",       \"proj_fut\" = \"navyblue\"     ),     breaks = c(\"obs_hist\", \"proj_hist\", \"proj_fut\")   ) +   theme_light() +   theme(axis.text.x = element_text(angle = 45, vjust = 0.5)) +   labs(x = \"Year\", col = \"\") +   facet_wrap(~variable, scales = \"free\", ncol = 1, strip.position = \"left\", )"},{"path":"https://bcgov.github.io/climr/articles/climr_workflow_int.html","id":"spatial-output-and-plotting-options","dir":"Articles","previous_headings":"Workflow with climr_downscale","what":"Spatial output and plotting options","title":"Intermediate `climr` workflow","text":"climr_downscale can also provide outputs form SpatVector points plot values chosen climate variable list passed climr_downscale(..., vars), case MAT.  course can now use vector output map variables top DEM raster, prettier visuals:","code":"ds_out_spatial <- climr_downscale(   xyz = xyzDT,   which_normal = \"auto\",   gcm_models = \"EC-Earth3\",   gcm_period = \"2021_2040\",   ssp = \"ssp245\",   max_run = 0,   return_normal = FALSE, ## don't return the 1961-1990 normals period   out_spatial = TRUE,   plot = \"MAT\",   vars = c(\"MAT\", \"PPT\", \"PAS\") ) vancouver <- get(data(\"vancouver\")) |>   unwrap()  par(mfrow = c(1, 2)) plot(vancouver_poly,   col = hcl.colors(50, palette = \"Earth\"),   plg = list(x = \"bottom\", title = \"Elevation\"),   mar = c(4, 1, 1, 4) ) plot(vancouver, add = TRUE, col = \"black\") plot(ds_out_spatial, \"MAT\",   col = hcl.colors(50, palette = \"Reds\"),   add = TRUE, type = \"continuous\",   plg = list(x = \"right\", title = \"MAT\") )  plot(vancouver_poly,   col = hcl.colors(50, palette = \"Earth\"),   plg = list(x = \"bottom\", title = \"Elevation\"),   mar = c(4, 1, 1, 4) ) plot(vancouver, add = TRUE, col = \"black\") plot(ds_out_spatial, \"PPT\",   col = hcl.colors(50, palette = \"Blues\"),   add = TRUE, type = \"continuous\",   plg = list(x = \"right\", title = \"PPT\") )"},{"path":"https://bcgov.github.io/climr/articles/climr_workflow_int.html","id":"workflow-with-_input-functions-and-downscale","dir":"Articles","previous_headings":"","what":"Workflow with *_input functions and downscale","title":"Intermediate `climr` workflow","text":"Alternatively, user may choose run climate data preparation downscaling functions separately. suggest least twice full understanding steps climr_downscale executes internally. Steps 1 2 bellow download prepare climate data used downscaling step (Step 3). use point locations downscaling.","code":""},{"path":"https://bcgov.github.io/climr/articles/climr_workflow_int.html","id":"get-climate-normals---normal_input","dir":"Articles","previous_headings":"Workflow with *_input functions and downscale","what":"1) Get climate normals - normal_input()","title":"Intermediate `climr` workflow","text":"using normal_input(), establish connection PostGIS server pass bounding box containing point locations interest. “auto” option select source climate normals. list_normal() provides list available options: ‘normal_na’ corresponds normals North America obtained ClimateNA (Wang et al. 2016); ‘normal_bc’ corresponds British Columbia PRISM normals; ‘normal_composite’ corresponds composite British Columbia PRISM, adjusted US PRISM DAYMET (Alberta Saskatchewan), covers western Canada western US. use ‘normal_composite’ highest resolution product area interest. extent downloaded climate anomalies often larger extent bounding box, vary depending spatial resolution data. demonstrate define bounding box set coordinates. Alternatively, get_bb used extract bounding box around point locations xyzDT. Downloaded normals shown North Vancouver area requested bounding box.","code":"list_normal() #> [1] \"normal_na\"        \"normal_bc\"        \"normal_composite\" dbCon <- data_connect() the_bb <- c(50, 49, -122, -124)  ## alternatively: # the_bb <- get_bb(xyzDT)  normals <- normal_input(dbCon,   bbox = the_bb,   normal = \"normal_composite\" ) #> ."},{"path":"https://bcgov.github.io/climr/articles/climr_workflow_int.html","id":"get-climate-projections-andor-historical-observations","dir":"Articles","previous_headings":"Workflow with *_input functions and downscale","what":"2) Get climate projections and/or historical observations","title":"Intermediate `climr` workflow","text":"Data historic future climate projections can obtained gcm_*() functions. gcm_hist_input() used obtain historical anomalies projected (several) GCM, whereas gcm_input() gcm_ts_input used obtain future anomaly projections period individual years (.e. time series). Historical observations given period individual years can obtained historic_input historic_input_ts, respectively. Downloaded historical future anomalies shown North Vancouver area requested bounding box.","code":"hist_proj <- gcm_hist_input(dbCon,   bbox = the_bb,   gcm = \"EC-Earth3\",   years = 2001:2020,   max_run = 0 ) #> .  fut_proj <- gcm_input(dbCon,   bbox = the_bb,   gcm = \"EC-Earth3\",   ssp = \"ssp245\",   period = \"2021_2040\",   max_run = 0 ) #> .  fut_proj_ts <- gcm_ts_input(dbCon,   bbox = the_bb,   gcm = \"EC-Earth3\",   ssp = \"ssp245\",   years = 2021:2040,   max_run = 0 )  hist_obs <- historic_input(dbCon,   bbox = the_bb,   period = \"2001_2020\" ) hist_obs_ts <- historic_input_ts(dbCon,   bbox = the_bb,   years = 2001:2020 ) #> ."},{"path":"https://bcgov.github.io/climr/articles/climr_workflow_int.html","id":"downscale-and-calculate-actual-values-i-e--not-anomalies","dir":"Articles","previous_headings":"Workflow with *_input functions and downscale","what":"3) Downscale and calculate actual values (i.e., not anomalies)","title":"Intermediate `climr` workflow","text":"Now necessary inputs, can downscale climate data. avoid repeating lines code input, ’ll use lapply() .call() iterate several climate inputs downscale. Note .call() work, list climate inputs (inputs) must named according downscale()’s argument names (can list formalArgs(downscale)). Binding tables results similar table one achieved used climr_downscale(). ‘all_downscale’ table binding. Outputs shown one location (‘id’)","code":"inputs <- list(   \"gcm\" = fut_proj,   \"historic\" = hist_obs,   \"gcm_ts\" = fut_proj_ts,   \"gcm_hist\" = hist_proj,   \"historic_ts\" = hist_obs_ts )  all_downscale <- sapply(names(inputs),   function(input_arg, xyzDT, normals, inputs) {     args <- list(inputs[[input_arg]])     names(args) <- input_arg      ## add a few more arguments     args <- append(       args,       list(         \"xyz\" = xyzDT,         \"normal\" = normals,         \"return_normal\" = FALSE,         \"vars\" = \"MAT\",         \"out_spatial\" = FALSE       )     )      return(do.call(downscale, args))   },   normals = normals, inputs = inputs, xyzDT )  all_downscale #> $gcm #> Key: <id, GCM, SSP, RUN, PERIOD> #>        id       GCM    SSP          RUN    PERIOD       MAT #>     <int>    <char> <char>       <char>    <char>     <num> #>  1:    87 EC-Earth3 ssp245 ensembleMean 2021_2040 11.241924 #>  2:   175 EC-Earth3 ssp245 ensembleMean 2021_2040 11.969482 #>  3:   191 EC-Earth3 ssp245 ensembleMean 2021_2040 10.772463 #>  4:   208 EC-Earth3 ssp245 ensembleMean 2021_2040 11.903974 #>  5:   209 EC-Earth3 ssp245 ensembleMean 2021_2040 10.501632 #> ---                                                         #> 84: 12904 EC-Earth3 ssp245 ensembleMean 2021_2040  7.239116 #> 85: 12905 EC-Earth3 ssp245 ensembleMean 2021_2040  9.616617 #> 86: 12918 EC-Earth3 ssp245 ensembleMean 2021_2040 11.666369 #> 87: 12925 EC-Earth3 ssp245 ensembleMean 2021_2040 11.779511 #> 88: 12936 EC-Earth3 ssp245 ensembleMean 2021_2040 11.949486 #>  #> $historic #> Key: <id, PERIOD> #>        id    PERIOD       MAT #>     <int>    <char>     <num> #>  1:    87 2001_2020 10.047888 #>  2:   175 2001_2020 10.784607 #>  3:   191 2001_2020  9.557805 #>  4:   208 2001_2020 10.723865 #>  5:   209 2001_2020  9.311382 #> ---                           #> 84: 12904 2001_2020  6.018799 #> 85: 12905 2001_2020  8.390223 #> 86: 12918 2001_2020 10.478055 #> 87: 12925 2001_2020 10.607733 #> 88: 12936 2001_2020 10.760592 #>  #> $gcm_ts #> Key: <id, GCM, SSP, RUN, PERIOD> #>          id       GCM    SSP          RUN PERIOD      MAT #>       <int>    <char> <char>       <char> <char>    <num> #>    1:    87 EC-Earth3 ssp245 ensembleMean   2021 10.98362 #>    2:    87 EC-Earth3 ssp245 ensembleMean   2022 11.53311 #>    3:    87 EC-Earth3 ssp245 ensembleMean   2023 11.05650 #>    4:    87 EC-Earth3 ssp245 ensembleMean   2024 10.78489 #>    5:    87 EC-Earth3 ssp245 ensembleMean   2025 11.31764 #>   ---                                                     #> 1756: 12936 EC-Earth3 ssp245 ensembleMean   2036 12.10103 #> 1757: 12936 EC-Earth3 ssp245 ensembleMean   2037 12.00270 #> 1758: 12936 EC-Earth3 ssp245 ensembleMean   2038 11.70371 #> 1759: 12936 EC-Earth3 ssp245 ensembleMean   2039 12.63359 #> 1760: 12936 EC-Earth3 ssp245 ensembleMean   2040 11.83683 #>  #> $gcm_hist #> Key: <id, GCM, RUN, PERIOD> #>          id       GCM          RUN PERIOD      MAT #>       <int>    <char>       <char> <char>    <num> #>    1:    87 EC-Earth3 ensembleMean   2001 10.37796 #>    2:    87 EC-Earth3 ensembleMean   2002 10.41935 #>    3:    87 EC-Earth3 ensembleMean   2003 10.94394 #>    4:    87 EC-Earth3 ensembleMean   2004 10.71435 #>    5:    87 EC-Earth3 ensembleMean   2005 10.92751 #>   ---                                              #> 1228: 12936 EC-Earth3 ensembleMean   2010 12.07629 #> 1229: 12936 EC-Earth3 ensembleMean   2011 12.19746 #> 1230: 12936 EC-Earth3 ensembleMean   2012 11.42260 #> 1231: 12936 EC-Earth3 ensembleMean   2013 10.97432 #> 1232: 12936 EC-Earth3 ensembleMean   2014 11.70544 #>  #> $historic_ts #> Key: <id, PERIOD> #>          id PERIOD      MAT #>       <int> <char>    <num> #>    1:    87   2001 10.20435 #>    2:    87   2002 10.35103 #>    3:    87   2003 10.81289 #>    4:    87   2004 11.28643 #>    5:    87   2005 10.86849 #>   ---                       #> 1756: 12936   2016 12.08256 #> 1757: 12936   2017 11.26032 #> 1758: 12936   2018 11.68008 #> 1759: 12936   2019 11.40181 #> 1760: 12936   2020 11.52093 all_downscale <- rbindlist(all_downscale, use.names = TRUE, fill = TRUE)"},{"path":[]},{"path":"https://bcgov.github.io/climr/articles/lapse_rates.html","id":"lapse-rates-calculation","dir":"Articles","previous_headings":"","what":"Lapse rates calculation","title":"Lapse rates","text":"Wang (2016) Climate North America algorithms retrieve monthly climate data elevation values location corresponding grid cell plus eight surrounding cells. climate elevation values nine cells used calculate differences climate variable elevation 36 possible pairs. simple linear regression differences climate variable difference elevation established, slope regression used empirical lapse rate climate variable specific location. local regressions dynamically developed along locations inquiry, call downscaling method “dynamic local downscaling” approach. avoid -adjustments due weak linear relationship, lapse rate weighted R-square value local linear regression. way done package, precompute lapse rates 36 variables store associated normal.","code":""},{"path":"https://bcgov.github.io/climr/articles/lapse_rates.html","id":"computation-details","dir":"Articles","previous_headings":"","what":"Computation details","title":"Lapse rates","text":"Starting equal extent digital elevation model raster (x) 36 climate variables rasters (pre delta method y’s). first convert rasters matrices way easier handle type operation. , since want compute everything one swell swoop, create border extended matrices handle lapse rates values edge raster. Starting sides corners Next step sample extended matrices 8 times compute differences original matrices. going give us stack 8 matrices 36 variables used compute linear regression coefficients. Regresssion coefficients computed using following methods R² adjustment applied. example using two starting matrices Start extending matrices Sample 8 times Now compute relevant coefficients","code":"#' Simple linear regression without the intercept term #' beta_coef = sum(xy) / sum(x²) #' mss = sum(x * beta_coef)², sum of squared fitted values #' rss = sum(ε²), sum of squared (y minus fitted), sum of absolute errors #' R² = mss / (mss + rss) #' Lapse rate = beta_coef * R² (dem <- matrix(sample(0:1000, 25), nrow = 5)) #>      [,1] [,2] [,3] [,4] [,5] #> [1,]  172  869  200  846  426 #> [2,]  406  878  196   76   61 #> [3,]  459  558  516  897  554 #> [4,]   62  926  766  445  772 #> [5,]  484  451  535  566  468 (tmax <- matrix(30 - (dem / 50) %/% 1, nrow = 5)) #>      [,1] [,2] [,3] [,4] [,5] #> [1,]   27   13   26   14   22 #> [2,]   22   13   27   29   29 #> [3,]   21   19   20   13   19 #> [4,]   29   12   15   22   15 #> [5,]   21   21   20   19   21 dem_ext <- climr:::recycle_borders(dem, 5, 5) #> Downloading and Caching ESM run info :) (tmax_ext <- climr:::recycle_borders(tmax, 5, 5)) #>      [,1] [,2] [,3] [,4] [,5] [,6] [,7] #> [1,]   27   27   13   26   14   22   22 #> [2,]   27   27   13   26   14   22   22 #> [3,]   22   22   13   27   29   29   29 #> [4,]   21   21   19   20   13   19   19 #> [5,]   29   29   12   15   22   15   15 #> [6,]   21   21   21   20   19   21   21 #> [7,]   21   21   21   20   19   21   21 dem_d <- climr:::deltas(dem_ext, 5, 5) (tmax_d <- climr:::deltas(tmax_ext, 5, 5)) #> $northwest #>      [,1] [,2] [,3] [,4] [,5] #> [1,]    0   14  -13   12   -8 #> [2,]    5   14  -14   -3  -15 #> [3,]    1    3   -7   14   10 #> [4,]   -8    9    4   -2   -2 #> [5,]    8    8   -8   -4    1 #>  #> $north #>      [,1] [,2] [,3] [,4] [,5] #> [1,]    0    0    0    0    0 #> [2,]    5    0   -1  -15   -7 #> [3,]    1   -6    7   16   10 #> [4,]   -8    7    5   -9    4 #> [5,]    8   -9   -5    3   -6 #>  #> $northeast #>      [,1] [,2] [,3] [,4] [,5] #> [1,]  -14   13  -12    8    0 #> [2,]   -9   13  -13   -7   -7 #> [3,]   -8    8    9   16   10 #> [4,]  -10    8   -2   -3    4 #> [5,]   -9   -6    2   -4   -6 #>  #> $east #>      [,1] [,2] [,3] [,4] [,5] #> [1,]  -14   13  -12    8    0 #> [2,]   -9   14    2    0    0 #> [3,]   -2    1   -7    6    0 #> [4,]  -17    3    7   -7    0 #> [5,]    0   -1   -1    2    0 #>  #> $southeast #>      [,1] [,2] [,3] [,4] [,5] #> [1,]  -14   14    3   15    7 #> [2,]   -3    7  -14  -10  -10 #> [3,]   -9   -4    2    2   -4 #> [4,]   -8    8    4   -1    6 #> [5,]    0   -1   -1    2    0 #>  #> $south #>      [,1] [,2] [,3] [,4] [,5] #> [1,]   -5    0    1   15    7 #> [2,]   -1    6   -7  -16  -10 #> [3,]    8   -7   -5    9   -4 #> [4,]   -8    9    5   -3    6 #> [5,]    0    0    0    0    0 #>  #> $southwest #>      [,1] [,2] [,3] [,4] [,5] #> [1,]   -5    9  -13   13    7 #> [2,]   -1    8   -8   -9  -16 #> [3,]    8   10   -8    2    3 #> [4,]   -8    9    6   -2    4 #> [5,]    0    0    1    1   -2 #>  #> $west #>      [,1] [,2] [,3] [,4] [,5] #> [1,]    0   14  -13   12   -8 #> [2,]    0    9  -14   -2    0 #> [3,]    0    2   -1    7   -6 #> [4,]    0   17   -3   -7    7 #> [5,]    0    0    1    1   -2 # Number of surrounding cells n <- length(dem_d) # Sums of x squared sum_xx <- climr:::sum_matrix(   climr:::sup(dem_d, 2) ) beta_coef <- climr:::sum_matrix(   climr:::prod_matrix(dem_d, tmax_d) ) / sum_xx # We need the fitted values to compute the # coefficient of determination f <- climr:::fitted(dem_d, beta_coef) # We use the same approach as stats::summary.lm # applied to a list matrices mss <- climr:::sum_matrix(   climr:::sup(f, 2) ) rss <- climr:::sum_matrix(   climr:::sup(     climr:::delta_matrix(tmax_d, f),     2   ) ) # We can combine the resulting matrices to get the # coefficient of determination and multiply by beta coficient (lapse_rate <- beta_coef * mss / (mss + rss)) #>             [,1]        [,2]        [,3]        [,4]        [,5] #> [1,] -0.02008744 -0.01991429 -0.01905148 -0.01914296 -0.01924584 #> [2,] -0.01963220 -0.01959146 -0.02044560 -0.01978590 -0.01938747 #> [3,] -0.01960868 -0.01996766 -0.01982820 -0.01927210 -0.01988396 #> [4,] -0.01974567 -0.01959050 -0.01996064 -0.02104873 -0.01960000 #> [5,] -0.01927916 -0.01898502 -0.02007731 -0.02041018 -0.01978681"},{"path":"https://bcgov.github.io/climr/articles/methods_downscaling.html","id":"stage-1-change-factor-aka-delta-downscaling","dir":"Articles","previous_headings":"","what":"Stage 1: change-factor (aka “delta”) downscaling","title":"`climr` downscaling methods","text":"climr uses simple method called change-factor downscaling. method sometimes referred climate imprint method (Hunter Meentemeyer 2005), delta method (Wang et al. 2016), simple mean bias correction (Maraun 2016). method adds low-spatial-resolution anomalies (e.g., climate model) high-resolution gridded climate map (Tabor Williams 2010). change-factor downscaling simplistic downscaling daily time series extremes indices, sufficient downscaling temperature precipitation data low temporal resolution (e.g., 20-year climate averages). default high-resolution climate maps used climr 800m gridded maps mean daily maximum temperature (Tmax), mean daily minimum temperature (Tmin), precipitation (PPT) 1961-1990 period. climr uses custom composite climate maps multiple sources: PRISM Climate Group (USA), Pacific Climate Impacts Consortium (BC), Daymet (Mexico Canada outside BC). one map month year, total 36 climate maps. July Tmax reference map looks like vicinity Vancouver, BC. climr 1961-1990 reference climate map July Tmax Global climate model data much lower resolution (60-200km grid scale). change July Tmax EC-Earth3 global climate model 2041-2060 time period, relative model’s 1961-1990 climate. case, warming greater areas (eastward) coast. Low-resolution anomalies (change) July Tmax EC-Earth3 global climate model 2041-2060 time period, relative model’s 1961-1990 climate downscale GCM projection, first interpolate low-resolution GCM anomaly (case, temperature change 1961-1990 2041-2060) resolution detailed reference climate map: Interpolation low-resolution climate model anomalies high resolution reference climate map. add smoothed anomalies high-resolution 1961-1990 climate map, resulting high-resolution map simulated climate 2041-2060. Downscaled 2041-2060 July Tmax EC-Earth model, resulting addition interpolated low-resolution model anomalies (change factors) high resolution 1961-1990 reference climate. case precipitation, multiply reference climate relative anomaly (e.g., multiply 1.07 7% increase precipitation), rather adding absolute anomaly. example illustrates change-factor downscaling able represent effect ocean reducing warming rates coastal areas, large-scale effect represented coarse resolution global climate model. However, downscaling produced uniform warming rate valley bottom mountain top. reality, expect large elevation-dependent differences warming rate due example changes snowpack. inability represent changes occur spatial scales smaller (large) global climate model grid cells important weakness change-factor downscaling statistical downscaling methods. Similarly, change-factor downscaling can’t represent role fine-scale features like lakes, vegetation, cold-air pooling, soil moisture. important considerations interpreting results statistical downscaling.","code":""},{"path":"https://bcgov.github.io/climr/articles/methods_downscaling.html","id":"stage-2-elevation-adjustment","dir":"Articles","previous_headings":"","what":"Stage 2: Elevation adjustment","title":"`climr` downscaling methods","text":"climr uses elevation adjustment downscale temperature variables scales finer resolution reference climate map. inferring relationship temperature elevation, known lapse rate, reference climate maps. local lapse rate calculated grid cell reference climate map using linear regression temperature elevation among focal cell 8 neighbours. gridded lapse rates included SpatRaster returned normal_input() function used . climr lapse rate layer July Tmax: July Tmax lapse rates (change temperature relative elevation; oC/m) used elevation adjustment example indicates BC PRISM maps July Tmax lower lapse rates maritime influenced mountains (4oC/km) mountains less maritime influence (8oC/km). map lapse rates artefacts areas relief; artefacts consequence unless users supply elevations areas deviate substantially realistic ground elevations areas flat topography (e.g., asking climr provide climate values 200m elevation Fraser River delta, uniformly sea level). can use climr_downscale() function 90m digital elevation model (DEM) illustrate elevation adjustment Vancouver’s north shore mountains, shown . 1961-1990 July Tmax 800m reference clmate map (left) elevation-adjusted 90m grid (right). Elevation adjustment provides visually appealing map can useful improving precision climate values points interest areas steep topography. However, important remember climr output represents effects regional climate elevation. Microclimatic factors aspect, vegetation, water bodies, frost pooling, soil moisture represented maps. default, climr doesn’t apply elevation adjustment precipitation, cases elevation influence precipitation scales less 1km. Instead, precipitation scales finer 800m simply interpolated nearest four grid points reference map. Users can choose apply elevation-adjustment precipitation selecting ppt_lr = TRUE downscale() function.","code":""},{"path":"https://bcgov.github.io/climr/articles/methods_downscaling.html","id":"stage-3-derived-variables","dir":"Articles","previous_headings":"","what":"Stage 3: Derived variables","title":"`climr` downscaling methods","text":"value delta downscaling isn’t just obtaining new absolute values temperature precipitation. allows us calculate anomalies indices don’t scale linearly temperature precipitation, degree-days precipitation snow. climr currently uses ClimateNA derived variable equations (Wang et al. 2016). equations developed fitting non-linear models relationship variable interest calculated daily weather station data monthly temperature /precipitation weather stations. example, equations January degree-days 0oC 18oC derived fitting piecewise function variables January mean temperature 1961-1990 period 4891 stations across North America, shown Figure 4 Wang et al. (2016): Figure 4 Wang et al. (2016), illustrating derivation equations January degree-days 0oC 18oC based January mean temperature North American weather stations Using climr output EC-Earth3 climate model, can compare change January mean temperature change January degree days 0oC 2041-2060 period relative 1961-1990 baseline. January mean temperature interpolated directly GCM, variation climate change trend variable transition one GCM grid cell neighbours. contrast, January degree-days 0oC, derived directly January mean temperature, strong elevation-dependence climate change trend. Downscaled change January mean temperature (left) derived variable January degree days 0oC (right), using EC-Earth model simulation 2041-2060.","code":""},{"path":[]},{"path":"https://bcgov.github.io/climr/articles/methods_downscaling.html","id":"high-resolution-climate-maps-used-by-climr","dir":"Articles","previous_headings":"climr data sources","what":"High-resolution climate maps used by climr","title":"`climr` downscaling methods","text":"default climate maps climr composite western North America south 60oN (800m grid scale). compiled composite PRISM Climate Group (USA), Pacific Climate Impacts Consortium (BC), Daymet (Canada outside BC). recommend reference climate map following reasons: (1) 800m resolution preserves localized lapse rates (e.g. temperature inversions) averaged 4km ClimateNA composite; (2) PRISM climatology BC preserved blending outwards BC border; (3) lapse rates Alberta Rockies better defined; (4) Tmin Washington, Idaho, Montana reconstructed correct unrealistic lapse rates. climr provides two options high-resolution reference climate map: ClimateNA composite North America, 4km grid scale (Wang et al. 2016). composite compiled separate PRISM climate surfaces BC, Alaska, Yukon/Alberta/Saskatchewan/Manitoba, contiguous US, WorldClim (Fick Hijmans 2017) remainder continent. User-supplied climate maps. downscale() function can accept climate map reference normals. allows user provide reference climate maps, : (1) Alternative publicly available gridded climatologies CHELSA, Daymet, Worldclim; (2) output weather models (e.g., WRF); (3) custom super-high resolution climate maps small study areas.","code":""},{"path":"https://bcgov.github.io/climr/articles/methods_downscaling.html","id":"historical-observational-time-series-and-climates","dir":"Articles","previous_headings":"climr data sources","what":"Historical observational time series and climates","title":"`climr` downscaling methods","text":"climr provides historical observed climates annual time series 1901-present 10-year, 20-year, 30-year periods 1951-2020. downscaled way global climate model data: adding low-resolution anomalies (change factors) high-resolution reference climate map. Temperature anomalies Climatic Research Unit (CRU) Time Series dataset. Precipitation anomalies Global Precipitation Climatology Centre global dataset, better representation Canadian precipitation stations CRU Time Series dataset.","code":""},{"path":[]},{"path":"https://bcgov.github.io/climr/authors.html","id":null,"dir":"","previous_headings":"","what":"Authors","title":"Authors and Citation","text":"Kiri Daust. Author. Colin Mahony. Author, maintainer. Bruno Tremblay. Author. Ceres Barros. Author. Francois Bornais. Contributor. Province British Columbia. Copyright holder, funder.","code":""},{"path":"https://bcgov.github.io/climr/authors.html","id":"citation","dir":"","previous_headings":"","what":"Citation","title":"Authors and Citation","text":"Daust K, Mahony C, Tremblay B, Barros C (2024). climr: Downscaling climate data R. R package version 0.0.4.","code":"@Manual{,   title = {climr: Downscaling climate data in R},   author = {Kiri Daust and Colin Mahony and Bruno Tremblay and Ceres Barros},   year = {2024},   note = {R package version 0.0.4}, }"},{"path":[]},{"path":"https://bcgov.github.io/climr/index.html","id":"climr-an-r-package-of-downscaled-climate-data-for-north-america","dir":"","previous_headings":"","what":"climr: An R package of downscaled climate data for North America","title":"Downscaling climate data in R","text":"climr experimental R package builds downscaling concepts operationalized ClimateNA tool (Wang et al. 2016). provides downscaling observational simulated climate data using change-factor (.k.. climate imprint) downscaling, simple method adds low-spatial-resolution climate anomalies high-spatial-resolution reference climatological map, additional elevation adjustment “scale-free” downscaling. climr designed fast minimize local data storage requirements. , uses remote PostGIS database, optionally caches data locally.","code":""},{"path":"https://bcgov.github.io/climr/index.html","id":"features","dir":"","previous_headings":"climr: An R package of downscaled climate data for North America","what":"Features","title":"Downscaling climate data in R","text":"climr provides following data: Historical observational time series (1902-2022), currently limited ClimateNA time series (Wang et al., 2016) Multiple historical (1851-2014) future (2015-2100) climate model simulations 13 CMIP6 global climate models, monthly time series 20-year normals User selection single multiple climate variables, derived variables following ClimateNA methodology Wang et al. (2016).","code":""},{"path":"https://bcgov.github.io/climr/index.html","id":"data-sources","dir":"","previous_headings":"climr: An R package of downscaled climate data for North America","what":"Data Sources","title":"Downscaling climate data in R","text":"high resolution reference climate maps Western Canada Western US custom 800m-resolution mosaic BC PRISM, adjusted US PRISM, Western Canada PRISM, Daymet (Alberta Saskatchewan). Reference climatologies North America 4km-resolution ClimateNA (Wang et al. 2016) mosaics PRISM (BC, US, W. Canada) WorldClim (rest North America). ClimateNA mosaics accessed AdaptWest. Historical observational time series obtained ClimateNA (Wang et al. 2016). CMIP6 global climate model simulations downloaded Earth System Grid Federation. majority downloads conducted Tongli Wang, Associate Professor UBC Department Forest Conservation Sciences. 13 global climate models selected climr, best practices ensemble analysis, described Mahony (2022).","code":""},{"path":"https://bcgov.github.io/climr/index.html","id":"installation","dir":"","previous_headings":"","what":"Installation","title":"Downscaling climate data in R","text":"climr available GitHub. install please use: want install development version:","code":"remotes::install_github(\"bcgov/climr\") remotes::install_github(\"bcgov/climr@devl\")"},{"path":"https://bcgov.github.io/climr/index.html","id":"usage","dir":"","previous_headings":"","what":"Usage","title":"Downscaling climate data in R","text":"See: vignette(\"climr_workflow_beg\") simple climr workflow; vignette(\"climr_workflow_int\") deeper dive climr advanced examples can used; vignette(\"climr_with_rasters\") several examples work climr using spatial inputs outputs, raster vector data.","code":""},{"path":"https://bcgov.github.io/climr/index.html","id":"methods","dir":"","previous_headings":"","what":"Methods","title":"Downscaling climate data in R","text":"overview downscaling methods used climr see vignette(\"lapse_rates\") vignette(\"methods_downscaling\")","code":""},{"path":"https://bcgov.github.io/climr/index.html","id":"license","dir":"","previous_headings":"Methods","what":"License","title":"Downscaling climate data in R","text":"Copyright 2024 Province British Columbia Licensed Apache License, Version 2.0 (“License”); may use file except compliance License. may obtain copy License http://www.apache.org/licenses/LICENSE-2.0 Unless required applicable law agreed writing, software distributed License distributed “” BASIS, WITHOUT WARRANTIES CONDITIONS KIND, either express implied. See License specific language governing permissions limitations License. climr logo uses icon designed Freepik, Flaticon.com, available .","code":""},{"path":"https://bcgov.github.io/climr/index.html","id":"references","dir":"","previous_headings":"Methods","what":"References","title":"Downscaling climate data in R","text":"acknowledge World Climate Research Programme, , Working Group Coupled Modelling, coordinated promoted CMIP6. thank climate modeling groups producing making available model output, Earth System Grid Federation (ESGF) archiving data providing access, multiple funding agencies support CMIP6 ESGF.","code":""},{"path":"https://bcgov.github.io/climr/index.html","id":"references-1","dir":"","previous_headings":"Methods","what":"References","title":"Downscaling climate data in R","text":"Mahony, Colin. 2022. “Rationale ClimateBC/NA 8-Model Ensemble Mean.” http://climatena.ca/downloads/ClimateNA_8ModelRationale_Mahony_07May2022.pdf. Wang, Tongli, Andreas Hamann, Dave Spittlehouse, Carlos Carroll. 2016. “Locally Downscaled Spatially Customizable Climate Data Historical Future Periods North America.” Edited Inés Álvarez. PLOS ONE 11 (6): e0156720.","code":""},{"path":"https://bcgov.github.io/climr/reference/BECcols.html","id":null,"dir":"Reference","previous_headings":"","what":"Colour sscheme for Biogeoclimatic Ecological Classification Zones — BECcols","title":"Colour sscheme for Biogeoclimatic Ecological Classification Zones — BECcols","text":"data.table RGB HEX colours biogeoclimatic zones BC.","code":""},{"path":"https://bcgov.github.io/climr/reference/BECcols.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Colour sscheme for Biogeoclimatic Ecological Classification Zones — BECcols","text":"","code":"BECcols"},{"path":"https://bcgov.github.io/climr/reference/BECcols.html","id":"format","dir":"Reference","previous_headings":"","what":"Format","title":"Colour sscheme for Biogeoclimatic Ecological Classification Zones — BECcols","text":"data.table","code":""},{"path":"https://bcgov.github.io/climr/reference/BECcols.html","id":"source","dir":"Reference","previous_headings":"","what":"Source","title":"Colour sscheme for Biogeoclimatic Ecological Classification Zones — BECcols","text":"colour scheme commonly used BC provincial government.","code":""},{"path":"https://bcgov.github.io/climr/reference/BECz_vancouver.html","id":null,"dir":"Reference","previous_headings":"","what":"Example Biogeoclimatic Ecological Classification Zones — BECz_vancouver","title":"Example Biogeoclimatic Ecological Classification Zones — BECz_vancouver","text":"shapefile biogeoclimatic zones coast Vancouver, BC, Canada. use data set, need terra::unwrap first, e.g.: BECz_vancouver <- terra::unwrap(get(data(BECz_vancouver)))","code":""},{"path":"https://bcgov.github.io/climr/reference/BECz_vancouver.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Example Biogeoclimatic Ecological Classification Zones — BECz_vancouver","text":"","code":"BECz_vancouver"},{"path":"https://bcgov.github.io/climr/reference/BECz_vancouver.html","id":"format","dir":"Reference","previous_headings":"","what":"Format","title":"Example Biogeoclimatic Ecological Classification Zones — BECz_vancouver","text":"PackedSpatVector","code":""},{"path":"https://bcgov.github.io/climr/reference/BECz_vancouver.html","id":"source","dir":"Reference","previous_headings":"","what":"Source","title":"Example Biogeoclimatic Ecological Classification Zones — BECz_vancouver","text":"obtained bcdata package, using bcdc_get_data(\"bec-map-generalized-1-20k-\")","code":""},{"path":"https://bcgov.github.io/climr/reference/BECz_vancouver_ras.html","id":null,"dir":"Reference","previous_headings":"","what":"Example Biogeoclimatic Ecological Classification Zones in raster format — BECz_vancouver_ras","title":"Example Biogeoclimatic Ecological Classification Zones in raster format — BECz_vancouver_ras","text":"categorical raster biogeoclimatic zones coast Vancouver, BC, Canada. Derived BECz_vancouver using dem_vancouver template extent, resolution projection information. use data set, need terra::unwrap first, e.g.: BECz_vancouver_ras <- terra::unwrap(get(data(BECz_vancouver_ras)))","code":""},{"path":"https://bcgov.github.io/climr/reference/BECz_vancouver_ras.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Example Biogeoclimatic Ecological Classification Zones in raster format — BECz_vancouver_ras","text":"","code":"BECz_vancouver_ras"},{"path":"https://bcgov.github.io/climr/reference/BECz_vancouver_ras.html","id":"format","dir":"Reference","previous_headings":"","what":"Format","title":"Example Biogeoclimatic Ecological Classification Zones in raster format — BECz_vancouver_ras","text":"PackedSpatRaster","code":""},{"path":"https://bcgov.github.io/climr/reference/BECz_vancouver_ras.html","id":"source","dir":"Reference","previous_headings":"","what":"Source","title":"Example Biogeoclimatic Ecological Classification Zones in raster format — BECz_vancouver_ras","text":"derived BECz_vancouver","code":""},{"path":"https://bcgov.github.io/climr/reference/Caching.html","id":null,"dir":"Reference","previous_headings":"","what":"Return package local cache path — cache_path","title":"Return package local cache path — cache_path","text":"Return package local cache path Clear package's local cache path Attempts delete folder/files cache_path().","code":""},{"path":"https://bcgov.github.io/climr/reference/Caching.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Return package local cache path — cache_path","text":"","code":"cache_path()  cache_clear(   what = c(\"gcm\", \"gcmts\", \"gcmhist\", \"normal\", \"historic\", \"historic_ts\") )"},{"path":"https://bcgov.github.io/climr/reference/Caching.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Return package local cache path — cache_path","text":"character. data folders cleared? Accepts \"normal\", \"gcm\" .","code":""},{"path":"https://bcgov.github.io/climr/reference/Caching.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"Return package local cache path — cache_path","text":"character. full path package local cache. TRUE FALSE depending whether cache cleared successfully .","code":""},{"path":"https://bcgov.github.io/climr/reference/Caching.html","id":"details","dir":"Reference","previous_headings":"","what":"Details","title":"Return package local cache path — cache_path","text":"default, uses tools::R_user_dir(). cache location can set using climr.cache.path option options(\"climr.cache.path\" = \"your_path\"). may fail R permission delete files/folders cache_path() directory","code":""},{"path":[]},{"path":"https://bcgov.github.io/climr/reference/climr-package.html","id":null,"dir":"Reference","previous_headings":"","what":"climr: Downscaling of global climate data — climr-package","title":"climr: Downscaling of global climate data — climr-package","text":"`climr` experimental R package builds downscaling concepts operationalized ClimateNA tool (climatena.ca) (Wang et al. 2016). provides downscaling observational simulated climate data using change-factor downscaling, simple method adds low-spatial-resolution climate anomalies high-spatial-resolution reference climatological map, additional elevation adjustment temperature. Elevation-adjusted monthly values basic climate elements (temperature precipitation) used estimate derived variables (e.g., degree-days) based published equations parameters Wang et al. 2016. `climr` designed fast minimize local data storage requirements. , uses remote PostGIS database, optionally caches data locally.","code":""},{"path":"https://bcgov.github.io/climr/reference/climr-package.html","id":"author","dir":"Reference","previous_headings":"","what":"Author","title":"climr: Downscaling of global climate data — climr-package","text":"Maintainer: Colin Mahony Colin.Mahony@gov.bc.ca (ORCID) Authors: Kiri Daust kiri.daust@gov.bc.ca Bruno Tremblay bruno@boostao.ca (ORCID) Ceres Barros ceres.barros@gov.bc.ca (ORCID) contributors: Francois Bornais francois@boostao.ca [contributor] Province British Columbia [copyright holder, funder]","code":""},{"path":"https://bcgov.github.io/climr/reference/climr_downscale.html","id":null,"dir":"Reference","previous_headings":"","what":"Self-contained change-factor downscaling of observed and simulated climate data — climr_downscale","title":"Self-contained change-factor downscaling of observed and simulated climate data — climr_downscale","text":"climr_downscale() provides downscaled climate variables user-specified locations. climr_downscale() adapts simple change-factor (aka \"delta') downscaling approach originally implemented ClimateNA. approach downscales climate data three stages: Change-factor downscaling coarse-resolution (50-200km grid) monthly temperature precipitation data climate models observational sources high-resolution (800m grid); Elevation adjustment temperature variables provide scales finer high-resolution reference grid; Calculating derived variables downscaled monthly temperature precipitation variables. See vignette(\"methods_downscaling\") description downscaling methodology. climr_downscale() user-friendly wrapper downscale()","code":""},{"path":"https://bcgov.github.io/climr/reference/climr_downscale.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Self-contained change-factor downscaling of observed and simulated climate data — climr_downscale","text":"","code":"climr_downscale(   xyz,   which_normal = \"auto\",   historic_period = NULL,   historic_ts = NULL,   gcm_models = NULL,   ssp = NULL,   gcm_period = NULL,   gcm_ts_years = NULL,   gcm_hist_years = NULL,   max_run = 0L,   cache = TRUE,   ... )"},{"path":"https://bcgov.github.io/climr/reference/climr_downscale.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Self-contained change-factor downscaling of observed and simulated climate data — climr_downscale","text":"xyz data.frame following columns \"long\", \"lat\", \"elev\", unique \"id\". extra columns ignored output. which_normal character. climatological normals map use high-resolution reference climate map downscaling. Default \"auto\", selects, query point, best available climatological normals map declining order normals_bc, normals_composite, normals_na. options one list_normal(), provide consistent reference map points. historic_period character. historic period observed climate data, averaged period. Options list_historic(). Default NULL historic_ts integer. Vector years obtain individual years time series observed climate data. Default NULL. See list_historic_ts() available years. gcm_models character. Vector global climate model names. Options list_gcm(). Used gcm periods, gcm timeseries, historic timeseries. Defaults NULL. ssp character. Vector SSP-RCP scenarios (representative concentration pathways paired shared socioeconomic pathways). Options list_ssp(). Defaults scenarios available. gcm_period character. 20-year normal periods GCM simulations. Options list_gcm_period(). Defaults NULL. gcm_ts_years character. Timeseries years GCM simulations future scenarios specified ssp. See list_gcm_ts() available years. Defaults NULL. gcm_hist_years character.  Timeseries years GCM simulations historical scenario. See list_gcm_hist_ts() available years. Defaults NULL. max_run integer. Maximum number model runs include. value 0 returns ensembleMean . Runs included order found models data max_run reached. Defaults 0L. cache logical. Cache data locally? Default TRUE ... arguments passed downscale(). Namely: return_normal, vars, out_spatial plot","code":""},{"path":"https://bcgov.github.io/climr/reference/climr_downscale.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"Self-contained change-factor downscaling of observed and simulated climate data — climr_downscale","text":"data.table downscaled climate variables location. outputs returned one table.","code":""},{"path":"https://bcgov.github.io/climr/reference/climr_downscale.html","id":"details","dir":"Reference","previous_headings":"","what":"Details","title":"Self-contained change-factor downscaling of observed and simulated climate data — climr_downscale","text":"downscale() parameters can applied climr_downscale(). example, setting ppt_lr = TRUE climr_downscale() apply elevation adjustment precipitation values. Although which_normal = \"auto\" default, users cautioned can produce artefacts associated downscaling different reference climate maps within outside western North American boundary normal_composite. recommend queries spanning boundary use which_normal = \"normal_na\".","code":""},{"path":"https://bcgov.github.io/climr/reference/climr_downscale.html","id":"ref-examples","dir":"Reference","previous_headings":"","what":"Examples","title":"Self-contained change-factor downscaling of observed and simulated climate data — climr_downscale","text":"","code":"library(data.table) library(terra) #> terra 1.7.71 #>  #> Attaching package: ‘terra’ #> The following object is masked from ‘package:data.table’: #>  #>     shift set.seed(123) dbCon <- data_connect() xyz <- data.frame(   lon = runif(10, -140, -106), lat = runif(10, 37, 61), elev = runif(10),   id = 1:10 )  ## get bounding box based on input points thebb <- get_bb(xyz) historic <- historic_input(dbCon, thebb, period = \"2001_2020\") #> Downloading historic anomalies #> . #> Caching data... plot(historic[[1]][[2]])   ## provide or create a lon, lat, elev, and optionally id, dataframe - usually read from csv file in_xyz <- data.frame(   lon = c(     -127.70521, -127.62279, -127.56235, -127.7162,     -127.18585, -127.1254, -126.94957, -126.95507   ),   lat = c(55.3557, 55.38847, 55.28537, 55.25721, 54.88135, 54.65636, 54.6913, 54.61025),   elev = c(291L, 296L, 626L, 377L, 424L, 591L, 723L, 633L),   id = 1:8,   Zone = c(rep(\"CWH\", 3), rep(\"CDF\", 5)),   Subzone = c(\"vm1\", \"vm2\", \"vs1\", rep(\"mm\", 3), \"dk\", \"dc\") )  ## historic observational time series vars <- c(\"PPT\", \"CMD\", \"Tave07\") climate_norms_hist <- climr_downscale(   xyz = in_xyz, which_normal = \"auto\",   return_normal = TRUE,   historic_period = \"2001_2020\",   vars = vars,   out_spatial = TRUE, plot = \"PPT\" ) ## specify desired variables to plot #> Welcome to climr! #> 'gcm_models' is missing. 'max_run' will be ignored #> Getting normals... #> Downloading new data... #> . #> Caching data... #> Getting historic... #> Retrieving from cache... #> Downscaling!! #> Plotting results for a single period/GCM/run/SSP   ## as a data.table climate_norms_hist <- climr_downscale(   xyz = in_xyz, which_normal = \"auto\",   return_normal = TRUE,   vars = vars,   out_spatial = FALSE, plot = \"PPT\" ) ## specify desired variables to plot #> Welcome to climr! #> 'gcm_models' is missing. 'max_run' will be ignored #> Getting normals... #> Retrieving from cache... #> Downscaling!! #> Warning: 'gcm', 'gcm_ts', 'gcm_hist', 'historic' and 'historic_ts' are missing. Nothing to downscale.  ## future projections climate_norms_fut <- climr_downscale(   xyz = in_xyz, which_normal = \"auto\",   gcm_models = c(\"ACCESS-ESM1-5\"),   ssp = c(\"ssp370\"),   gcm_period = c(\"2021_2040\"),   # gcm_ts_years = 2020:2060,   max_run = 3, #' we want 3 individual runs for each model   vars = vars ) #> Welcome to climr! #> Getting normals... #> Retrieving from cache... #> Getting GCMs... #> Downloading GCM anomalies #> . #> Caching data... #> Downscaling!!"},{"path":"https://bcgov.github.io/climr/reference/data-option-lists.html","id":null,"dir":"Reference","previous_headings":"","what":"List available runs, global circulation models, periods and climate scenarios — list_gcm","title":"List available runs, global circulation models, periods and climate scenarios — list_gcm","text":"list_gcm lists available global circulation models. list_ssp lists available shared socioeconomic pathways. list_gcm_period lists available periods. list_run lists available runs given GCM. list_normal lists available normals. list_historic lists available historic periods list_variables lists climate variables list_historic_ts lists available years historic time series list_gcm_ts lists available years future projections' time series list_gcm_hist_ts lists available years historic projections' time series","code":""},{"path":"https://bcgov.github.io/climr/reference/data-option-lists.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"List available runs, global circulation models, periods and climate scenarios — list_gcm","text":"","code":"list_gcm()  list_ssp()  list_gcm_period()  list_run(dbCon, gcm)  list_normal()  list_historic()  list_variables(   set = c(\"All\", \"Monthly\", \"Seasonal\", \"Annual\"),   only_extra = FALSE )  list_historic_ts()  list_gcm_ts()  list_gcm_hist_ts()"},{"path":"https://bcgov.github.io/climr/reference/data-option-lists.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"List available runs, global circulation models, periods and climate scenarios — list_gcm","text":"dbCon db connection object created data_connect. gcm Character vector specify requested GCMs set character. One , Monthly, Seasonal, Annual, combination thereof. Defaults \"\". only_extra logical. Tmin, Tmax PPT excluded? Defaults FALSE.","code":""},{"path":"https://bcgov.github.io/climr/reference/data-option-lists.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"List available runs, global circulation models, periods and climate scenarios — list_gcm","text":"character vector.","code":""},{"path":"https://bcgov.github.io/climr/reference/data-option-lists.html","id":"details","dir":"Reference","previous_headings":"","what":"Details","title":"List available runs, global circulation models, periods and climate scenarios — list_gcm","text":"Currently available normals (list_normal()) : \"normal_na\" Climate NA derived normals \"normal_bc\" British Columbia PRISM climatologies derived normals \"normal_composite\" composite BC PRISM, adjusted US PRISM DAYMET (Alberta Saskatchewan), covering western Canada western US.","code":""},{"path":"https://bcgov.github.io/climr/reference/data_connect.html","id":null,"dir":"Reference","previous_headings":"","what":"Connect to PostGIS database — data_connect","title":"Connect to PostGIS database — data_connect","text":"Connect PostGIS database","code":""},{"path":"https://bcgov.github.io/climr/reference/data_connect.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Connect to PostGIS database — data_connect","text":"","code":"data_connect()"},{"path":"https://bcgov.github.io/climr/reference/data_connect.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"Connect to PostGIS database — data_connect","text":"pool object database connection","code":""},{"path":"https://bcgov.github.io/climr/reference/dem_vancouver.html","id":null,"dir":"Reference","previous_headings":"","what":"Example DEM — dem_vancouver","title":"Example DEM — dem_vancouver","text":"Digital elevation model North Vancouver, BC, Canada. use data set, need terra::unwrap first, e.g.: dem_vancouver <- terra::unwrap(get(data(dem_vancouver)))","code":""},{"path":"https://bcgov.github.io/climr/reference/dem_vancouver.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Example DEM — dem_vancouver","text":"","code":"dem_vancouver"},{"path":"https://bcgov.github.io/climr/reference/dem_vancouver.html","id":"format","dir":"Reference","previous_headings":"","what":"Format","title":"Example DEM — dem_vancouver","text":"PackedSpatRaster","code":""},{"path":"https://bcgov.github.io/climr/reference/dem_vancouver.html","id":"source","dir":"Reference","previous_headings":"","what":"Source","title":"Example DEM — dem_vancouver","text":"todo add/describe source","code":""},{"path":"https://bcgov.github.io/climr/reference/dem_vancouver_lowres.html","id":null,"dir":"Reference","previous_headings":"","what":"Example low resolution DEM — dem_vancouver_lowres","title":"Example low resolution DEM — dem_vancouver_lowres","text":"lower resolution version dem_vancouver, re-projected 0.005 degrees. use data set, need terra::unwrap first, e.g.: dem_vancouver_lowres <- terra::unwrap(get(data(dem_vancouver_lowres)))","code":""},{"path":"https://bcgov.github.io/climr/reference/dem_vancouver_lowres.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Example low resolution DEM — dem_vancouver_lowres","text":"","code":"dem_vancouver_lowres"},{"path":"https://bcgov.github.io/climr/reference/dem_vancouver_lowres.html","id":"format","dir":"Reference","previous_headings":"","what":"Format","title":"Example low resolution DEM — dem_vancouver_lowres","text":"PackedSpatRaster","code":""},{"path":"https://bcgov.github.io/climr/reference/dem_vancouver_lowres.html","id":"source","dir":"Reference","previous_headings":"","what":"Source","title":"Example low resolution DEM — dem_vancouver_lowres","text":"todo add/describe source","code":""},{"path":"https://bcgov.github.io/climr/reference/downscale.html","id":null,"dir":"Reference","previous_headings":"","what":"Change-factor downscaling of user-supplied climate data — downscale","title":"Change-factor downscaling of user-supplied climate data — downscale","text":"downscale() engine climr_downscale(). takes user-supplied high- low-resolution rasters input downscales user-specified point locations. less user-friendly climr_downscale(), downscale() flexible users can supply raster inputs. example, user supply high-resolution climate map, instead available climr, input normal.","code":""},{"path":"https://bcgov.github.io/climr/reference/downscale.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Change-factor downscaling of user-supplied climate data — downscale","text":"","code":"downscale(   xyz,   normal,   gcm = NULL,   historic = NULL,   gcm_ts = NULL,   gcm_hist = NULL,   historic_ts = NULL,   return_normal = TRUE,   vars = sort(sprintf(c(\"PPT%02d\", \"Tmax%02d\", \"Tmin%02d\"), sort(rep(1:12, 3)))),   ppt_lr = FALSE,   nthread = 1L,   out_spatial = FALSE,   plot = NULL )"},{"path":"https://bcgov.github.io/climr/reference/downscale.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Change-factor downscaling of user-supplied climate data — downscale","text":"xyz data.frame following columns \"long\", \"lat\", \"elev\", unique \"id\". extra columns ignored output. normal SpatRaster. Outputs normal_input(). high-resolution climate maps use downscaling baseline. gcm list SpatRasters. Outputs gcm_input(). Global climate model data 20-year normal periods downscaled. Default NULL. historic list SpatRasters. Outputs historic_input(). Observed climate data 20-year normal periods downscaled. Default NULL. gcm_ts list SpatRasters. Outputs gcm_ts_input(). Global climate model time series ssp-rcp scenarios downscaled. Default NULL. gcm_hist list SpatRasters. Outputs gcm_hist_input(). Global climate model time series historical scenario downscaled. Default NULL. historic_ts list SpatRasters. Outputs historic_input_ts(). Observed climate time series downscaled. Default NULL. return_normal logical. Return downscaled normal period (1961-1990)? Default TRUE. vars character. vector climate variables compute. Supported variables can obtained list_variables(). Definitions can found package variables dataset. Default monthly PPT, Tmax, Tmin. ppt_lr logical. Apply elevation adjustment precipitation. Default FALSE. nthread integer. Number parallel threads use computations. Default 1L. out_spatial logical. SpatVector returned instead data.frame. plot character. out_spatial TRUE, name variable plot. variable exists normal, normal values also plotted. Otherwise, normal January total precipitation (PPT01) values plotted. Defaults plotting (NULL).","code":""},{"path":"https://bcgov.github.io/climr/reference/downscale.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"Change-factor downscaling of user-supplied climate data — downscale","text":"data.table SpatVector downscaled climate variables. gcm NULL, just downscaled normal point locations. gcm provided, returns downscaled dataset point location, general circulation model (GCM), shared socioeconomic pathway (SSP), run period.","code":""},{"path":"https://bcgov.github.io/climr/reference/downscale.html","id":"details","dir":"Reference","previous_headings":"","what":"Details","title":"Change-factor downscaling of user-supplied climate data — downscale","text":"recommend climr_downscale() purposes.","code":""},{"path":[]},{"path":"https://bcgov.github.io/climr/reference/downscale.html","id":"ref-examples","dir":"Reference","previous_headings":"","what":"Examples","title":"Change-factor downscaling of user-supplied climate data — downscale","text":"","code":"dbCon <- data_connect() on.exit(try(pool::poolClose(dbCon))) xyz <- data.frame(lon = runif(10, -140, -106), lat = runif(10, 37, 61), elev = runif(10), id = 1:10)  ## get bounding box based on input points thebb <- get_bb(xyz) normal <- normal_input(dbCon = dbCon, bbox = thebb, cache = TRUE) #> Not fully cached :( Will download more #> Downloading new data... #> Error in poolCheckout(pool): The pool has been closed.  ## pick one GCM, one SSP and one period from the list of available options gcm <- gcm_input(dbCon, thebb, gcm = list_gcm()[3], list_ssp()[1], list_gcm_period()[2]) #> Error in poolCheckout(pool): The pool has been closed.  ## notice coarseness of the data terra::plot(gcm[[1]]) #> Error in h(simpleError(msg, call)): error in evaluating the argument 'x' in selecting a method for function 'plot': object 'gcm' not found  downscale(xyz, normal, gcm) #> Error in eval(expr, envir, enclos): object 'normal' not found historic <- historic_input(dbCon, thebb) #> Retrieving from cache... terra::plot(historic[[1]])   downscale(xyz, normal, gcm = NULL, historic = historic, ppt_lr = FALSE) #> Error in eval(expr, envir, enclos): object 'normal' not found"},{"path":"https://bcgov.github.io/climr/reference/gcm-input-data.html","id":null,"dir":"Reference","previous_headings":"","what":"Retrieve GCM anomalies for downscale. — gcm_input","title":"Retrieve GCM anomalies for downscale. — gcm_input","text":"gcm_input retrieves anomalies GCM data, given chosen GCMs, SSPs, periods runs. gcm_hist_input creates GCM historic time series inputs, given chosen GCMs, years runs. gcm_ts_input creates future GCM time series inputs, given chosen GCMs, SSPs, years runs.","code":""},{"path":"https://bcgov.github.io/climr/reference/gcm-input-data.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Retrieve GCM anomalies for downscale. — gcm_input","text":"","code":"gcm_input(   dbCon,   bbox = NULL,   gcm = list_gcm(),   ssp = list_ssp(),   period = list_gcm_period(),   max_run = 0L,   cache = TRUE )  gcm_hist_input(   dbCon,   bbox = NULL,   gcm = list_gcm(),   years = 1901:1950,   max_run = 0L,   cache = TRUE )  gcm_ts_input(   dbCon,   bbox = NULL,   gcm = list_gcm(),   ssp = list_ssp(),   years = 2020:2030,   max_run = 0L,   cache = TRUE )"},{"path":"https://bcgov.github.io/climr/reference/gcm-input-data.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Retrieve GCM anomalies for downscale. — gcm_input","text":"dbCon db connection object created data_connect. bbox numeric. Vector length 4 giving bounding box study region, order ymax,ymin,xmax,xmin. general created get_bb(), can also user-defined. gcm character. Vector labels global circulation models use. Can obtained list_gcm(). Default GCMs available. ssp character. Vector SSP-RCP scenarios (representative concentration pathways paired shared socioeconomic pathways). Options list_ssp(). Defaults scenarios available. period character. Vector labels periods use. Can obtained list_gcm_period(). Defaults periods available. max_run integer. Maximum number model runs include. value 0 returns ensembleMean . Runs included order found models data max_run reached. Defaults 0L. cache logical. Specifying whether cache new data locally . Defaults TRUE. years Numeric character vector 2020:2100. Defaults 2020:2030. See list_gcm_ts() available years.","code":""},{"path":"https://bcgov.github.io/climr/reference/gcm-input-data.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"Retrieve GCM anomalies for downscale. — gcm_input","text":"list SpatRasters, possibly multiple layers, can used downscale(). list SpatRasters, possibly multiple layers, can used downscale(). list SpatRasters, possibly multiple layers, can used downscale().","code":""},{"path":"https://bcgov.github.io/climr/reference/gcm-input-data.html","id":"details","dir":"Reference","previous_headings":"","what":"Details","title":"Retrieve GCM anomalies for downscale. — gcm_input","text":"function returns list one slot requested GCM. Rasters inside list contain anomalies requested SSPs, runs, periods. general function used combination downscale(). function returns list one slot requested GCM. Rasters inside list contain anomalies runs years. general function used combination downscale(). function returns list one slot requested GCM. Rasters inside list contain anomalies SSPs, runs years. general function used combination downscale(). Note request multiple runs, multiple SSPs, lot years, take download data (lot ).","code":""},{"path":[]},{"path":"https://bcgov.github.io/climr/reference/gcm-input-data.html","id":"ref-examples","dir":"Reference","previous_headings":"","what":"Examples","title":"Retrieve GCM anomalies for downscale. — gcm_input","text":"","code":"library(terra) xyz <- data.frame(lon = runif(10, -140, -106), lat = runif(10, 37, 61), elev = runif(10), id = 1:10)  ## get bounding box based on input points thebb <- get_bb(xyz)  ## get database connection dbCon <- data_connect() on.exit(try(pool::poolClose(dbCon)))  gcm <- gcm_input(dbCon, thebb, list_gcm()[1], list_ssp()[1]) #> Not fully cached :( Will download more #> Error in poolCheckout(pool): The pool has been closed.  ## show ensemble means only lyrs <- grep(\"ensemble\", names(gcm$`ACCESS-ESM1-5`)) #> Error in eval(expr, envir, enclos): object 'gcm' not found  plot(gcm$`ACCESS-ESM1-5`[[lyrs]]) #> Error in h(simpleError(msg, call)): error in evaluating the argument 'x' in selecting a method for function 'plot': object 'gcm' not found  {   library(terra)   xyz <- data.frame(lon = runif(10, -140, -106), lat = runif(10, 37, 61), elev = runif(10), id = 1:10)    ## get bounding box based on input points   thebb <- get_bb(xyz)    ## get database connection   dbCon <- data_connect()   on.exit(try(pool::poolClose(dbCon)))    gcm_hist <- gcm_hist_input(dbCon, thebb, list_gcm()[1])    ## show ensemble means only   lyrs <- grep(\"ensemble\", names(gcm_hist$`ACCESS-ESM1-5`))    plot(gcm_hist$`ACCESS-ESM1-5`[[lyrs]]) } #> Downloading GCM anomalies #> Caching data...   library(terra) xyz <- data.frame(lon = runif(10, -140, -106), lat = runif(10, 37, 61), elev = runif(10), id = 1:10)  ## get bounding box based on input points thebb <- get_bb(xyz)  ## get database connection dbCon <- data_connect() on.exit(try(pool::poolClose(dbCon)))  gcm_ts <- gcm_ts_input(dbCon, thebb, list_gcm()[1], list_ssp()[1]) #> Error in poolCheckout(pool): The pool has been closed.  ## show ensemble means only lyrs <- grep(\"ensemble\", names(gcm_ts$`ACCESS-ESM1-5`)) #> Error in eval(expr, envir, enclos): object 'gcm_ts' not found  plot(gcm_ts$`ACCESS-ESM1-5`[[lyrs]]) #> Error in h(simpleError(msg, call)): error in evaluating the argument 'x' in selecting a method for function 'plot': object 'gcm_ts' not found"},{"path":"https://bcgov.github.io/climr/reference/get_bb.html","id":null,"dir":"Reference","previous_headings":"","what":"Find bounding box of data — get_bb","title":"Find bounding box of data — get_bb","text":"Find bounding box data","code":""},{"path":"https://bcgov.github.io/climr/reference/get_bb.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Find bounding box of data — get_bb","text":"","code":"get_bb(in_xyz)"},{"path":"https://bcgov.github.io/climr/reference/get_bb.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Find bounding box of data — get_bb","text":"in_xyz data.table (data.frame) points downscale columns \"lon\", \"lat\", \"elev\" \"id\"","code":""},{"path":"https://bcgov.github.io/climr/reference/get_bb.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"Find bounding box of data — get_bb","text":"numeric vector. Bounding box coordinates order ymax,ymin,xmax,xmin (e.g. c(51, 50, -121, -122)).","code":""},{"path":"https://bcgov.github.io/climr/reference/hist-input-data.html","id":null,"dir":"Reference","previous_headings":"","what":"Download historic period anomalies. — historic_input","title":"Download historic period anomalies. — historic_input","text":"historic_input produces anomalies historic observed climate given period. historic_input_ts produces anomalies historic observed climate given time series.","code":""},{"path":"https://bcgov.github.io/climr/reference/hist-input-data.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Download historic period anomalies. — historic_input","text":"","code":"historic_input(dbCon, bbox = NULL, period = list_historic(), cache = TRUE)  historic_input_ts(dbCon, bbox = NULL, years = 2010:2022, cache = TRUE)"},{"path":"https://bcgov.github.io/climr/reference/hist-input-data.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Download historic period anomalies. — historic_input","text":"dbCon db connection object created data_connect. bbox numeric. Vector length 4 giving bounding box study region, order ymax,ymin,xmax,xmin. general created get_bb(), can also user-defined. period character. Vector labels periods use. Can obtained list_historic(). Default \"2001_2020\". cache logical. Specifying whether cache new data locally . Defaults TRUE. years numeric. Years retrieve historic anomalies . Defaults 2010:2022. See list_historic_ts() available years.","code":""},{"path":"https://bcgov.github.io/climr/reference/hist-input-data.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"Download historic period anomalies. — historic_input","text":"list SpatRasters, possibly multiple layers, can used downscale(). element list corresponds particular period, values SpatRaster anomalies historic period compare normal period. List length 1 containing SpatRaster","code":""},{"path":"https://bcgov.github.io/climr/reference/hist-input-data.html","id":"details","dir":"Reference","previous_headings":"","what":"Details","title":"Download historic period anomalies. — historic_input","text":"Generally, function used combination downscale() values returned rasters anomalies compared 1961-1990 normal period, usually meaningful without whole downscale process. returned raster contains anomalies year specified years. general function used conjunction downscale().","code":""},{"path":[]},{"path":"https://bcgov.github.io/climr/reference/lapse_rate.html","id":null,"dir":"Reference","previous_headings":"","what":"Calculation of gridded lapse rates — lapse_rate","title":"Calculation of gridded lapse rates — lapse_rate","text":"function computes lapse rates (linear relationship climate variable elevation) across user-provided rasters. Lapse rates calculated using simple linear regression (without intercept) using focal cell eight neighbors observations. gridded lapse rates used downscale() climr_downscale() elevation adjustment climate values downscaling user-specified locations. method illustrated vignette vignette(\"lapse_rates\")","code":""},{"path":"https://bcgov.github.io/climr/reference/lapse_rate.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Calculation of gridded lapse rates — lapse_rate","text":"","code":"lapse_rate(normal, dem, NA_replace = TRUE, nthread = 1L, rasterize = TRUE)"},{"path":"https://bcgov.github.io/climr/reference/lapse_rate.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Calculation of gridded lapse rates — lapse_rate","text":"normal SpatRaster stack. climate rasters compute lapse rates . Build package functions. dem SpatRaster. digital elevation model raster. needed normal SpatRaster. Defaults NULL. NA_replace logical. NA lapse rate results replaced zeros. Default TRUE. nthread integer. Number parallel threads use compute lapse rates. rasterize logical. Return object class category normal extent? Default TRUE.","code":""},{"path":"https://bcgov.github.io/climr/reference/lapse_rate.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"Calculation of gridded lapse rates — lapse_rate","text":"SpatRaster lapse rate values.","code":""},{"path":"https://bcgov.github.io/climr/reference/lapse_rate.html","id":"details","dir":"Reference","previous_headings":"","what":"Details","title":"Calculation of gridded lapse rates — lapse_rate","text":"Formulas  beta_coef = sum(xy) / sum(x²)  mss = sum(x * beta_coef)², sum squared fitted values  rss = sum(ε²), sum squared (y minus fitted), sum absolute errors  R² = mss / (mss + rss)  Lapse rate = beta_coef * R²","code":""},{"path":"https://bcgov.github.io/climr/reference/normal-input-data.html","id":null,"dir":"Reference","previous_headings":"","what":"Retrieve climatologies for normal period — normal_input","title":"Retrieve climatologies for normal period — normal_input","text":"function downloads (retrieves cache) monthly Tmin, Tmax, PPT variables specified climatology specified bounding box. intended use downscale(), can also used stand-alone climatology.","code":""},{"path":"https://bcgov.github.io/climr/reference/normal-input-data.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Retrieve climatologies for normal period — normal_input","text":"","code":"normal_input(dbCon, bbox, normal = \"normal_na\", cache = TRUE)"},{"path":"https://bcgov.github.io/climr/reference/normal-input-data.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Retrieve climatologies for normal period — normal_input","text":"dbCon db connection object created data_connect. bbox numeric. Vector length 4 giving bounding box study region, order ymax,ymin,xmax,xmin. general created get_bb(), can also user-defined. normal character SpatRaster. character, label normal baseline use. Can obtained list_normal(). SpatRaster, 36 layers normal climate variables names PPT01:PPT12, Tmax01:Tmax12 Tmin01:Tmin12. Defaults list_normal()[1]. cache logical. Specifying whether cache new data locally . Defaults TRUE.","code":""},{"path":"https://bcgov.github.io/climr/reference/normal-input-data.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"Retrieve climatologies for normal period — normal_input","text":"SpatRaster containing normals, lapse rates digital elevation model layers, can used downscale().","code":""},{"path":"https://bcgov.github.io/climr/reference/normal-input-data.html","id":"details","dir":"Reference","previous_headings":"","what":"Details","title":"Retrieve climatologies for normal period — normal_input","text":"first 36 layers output raster correspond actual climate variables. raster also contains lapse rates variable, corresponding digital elevation model.","code":""},{"path":[]},{"path":"https://bcgov.github.io/climr/reference/pgGetTerra.html","id":null,"dir":"Reference","previous_headings":"","what":"Download raster with bounding box from PostGIS — pgGetTerra","title":"Download raster with bounding box from PostGIS — pgGetTerra","text":"Download raster bounding box PostGIS","code":""},{"path":"https://bcgov.github.io/climr/reference/pgGetTerra.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Download raster with bounding box from PostGIS — pgGetTerra","text":"","code":"pgGetTerra(conn, name, tile, rast = \"rast\", bands = 37:73, boundary)"},{"path":"https://bcgov.github.io/climr/reference/pgGetTerra.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Download raster with bounding box from PostGIS — pgGetTerra","text":"conn DBI RPostgres connection object. name character. Table name database. tile Logical. Retrieve data tiles avoid overloading database? rast character. Name column stores raster data. Defaults \"rast\" bands numeric. raster bands return. Default 37:73. boundary numeric. Vector length 4 (ymax,ymin,xmax,xmin). Defaults NULL.","code":""},{"path":"https://bcgov.github.io/climr/reference/pgGetTerra.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"Download raster with bounding box from PostGIS — pgGetTerra","text":"SpatRaster","code":""},{"path":"https://bcgov.github.io/climr/reference/plot_bivariate.html","id":null,"dir":"Reference","previous_headings":"","what":"Bivariate climate change plots — plot_bivariate","title":"Bivariate climate change plots — plot_bivariate","text":"Bivariate plots 21st century climate change user-selected locations climate variables. purposes plot show differences climate change trends among global climate models (GCMs), show differences multiple simulations model, compare simulated climate change observed climate change 2001-2020 period. climate changes relative 1961-1990 reference period normals.","code":""},{"path":"https://bcgov.github.io/climr/reference/plot_bivariate.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Bivariate climate change plots — plot_bivariate","text":"","code":"plot_bivariate(   xyz,   xvar = \"Tave_sm\",   yvar = \"PPT_sm\",   period_focal = list_gcm_period()[1],   gcm_models = list_gcm()[c(1, 4, 5, 6, 7, 10, 11, 12)],   ssp = list_ssp()[2],   historic_period = list_historic()[1],   gcm_period = list_gcm_period(),   max_run = 10,   legend_pos = \"bottomleft\",   show_runs = TRUE,   show_ensMean = TRUE,   show_observed = TRUE,   show_trajectories = TRUE,   interactive = FALSE,   cache = TRUE )"},{"path":"https://bcgov.github.io/climr/reference/plot_bivariate.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Bivariate climate change plots — plot_bivariate","text":"xyz data.frame following columns \"long\", \"lat\", \"elev\", unique \"id\". extra columns ignored output. xvar character. x-axis variable. options list_variables(). yvar character. y-axis variable. options list_variables(). period_focal character. 20-year period plot ensemble detail. options list_gcm_period(). gcm_models character. Vector global climate model names. Options list_gcm(). Used gcm periods, gcm timeseries, historic timeseries. Defaults NULL. ssp character. Vector SSP-RCP scenarios (representative concentration pathways paired shared socioeconomic pathways). Options list_ssp(). Defaults scenarios available. historic_period character. historic period observed climate data, averaged period. Options list_historic(). Default NULL gcm_period character. 20-year normal periods GCM simulations. Options list_gcm_period(). Defaults NULL. max_run integer. Maximum number model runs include. value 0 returns ensembleMean . Runs included order found models data max_run reached. Defaults 0L. legend_pos character. Position legend. Options c(\"bottomright\", \"bottom\", \"bottomleft\", \"left\", \"topleft\", \"top\", \"topright\", \"right\", \"center\"). show_runs logical. TRUE, individual runs model plotted (period_focal ) addition single-model ensemble mean. show_ensMean logical. TRUE, multi-model ensemble mean plotted (period_focal ). show_observed logical. TRUE, 2001-2020 observed climate plotted. show_trajectories logical. TRUE, values single-model ensemble mean plotted 20-year periods list_gcm_period(), connected interpolation spline. interactive logical. TRUE, interactive plot generated using {plotly}. FALSE, plot generated using base graphics. cache logical. Cache data locally? Default TRUE","code":""},{"path":"https://bcgov.github.io/climr/reference/plot_bivariate.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"Bivariate climate change plots — plot_bivariate","text":"NULL. Draws plot active graphics device.","code":""},{"path":"https://bcgov.github.io/climr/reference/plot_bivariate.html","id":"details","dir":"Reference","previous_headings":"","what":"Details","title":"Bivariate climate change plots — plot_bivariate","text":"input table xyz can single location multiple locations. multiple locations, plot provides mean anomalies locations. climate change trajectories provided show_trajectories points five 20-year periods specified list_gcm_period(). points connected interpolation spline x variable monotonic; otherwise trajectory points connected straight lines. plot designed used single SSP scenario. multiple scenarios passed plot, GCM means ensemble mean averaged across scenarios, individual runs scenarios plotted separately.","code":""},{"path":"https://bcgov.github.io/climr/reference/plot_bivariate.html","id":"ref-examples","dir":"Reference","previous_headings":"","what":"Examples","title":"Bivariate climate change plots — plot_bivariate","text":"","code":"# data frame of arbitrary points on Vancouver Island my_points <- data.frame(   lon = c(-123.4404, -123.5064, -124.2317),   lat = c(48.52631, 48.46807, 49.21999),   elev = c(52, 103, 357),   id = LETTERS[1:3] )  # draw the plot plot_bivariate(my_points) #> Welcome to climr! #> Getting normals... #> Not fully cached :( Will download more #> Downloading new data... #> . #> Caching data... #> Getting historic... #> Retrieving from cache... #> Getting GCMs... #> Not fully cached :( Will download more #> Downloading GCM anomalies #> Caching data... #> Downloading GCM anomalies #> . #> Caching data... #> Downloading GCM anomalies #> . #> Caching data... #> Downloading GCM anomalies #> . #> Caching data... #> Downloading GCM anomalies #> . #> Caching data... #> Downloading GCM anomalies #> . #> Caching data... #> Downloading GCM anomalies #> . #> Caching data... #> Downloading GCM anomalies #> . #> Caching data... #> Downscaling!!   # export plot to a temporary directory figDir <- tempdir() png(   filename = file.path(figDir, \"plot_test.png\"), type = \"cairo\", units = \"in\",   width = 6, height = 5, pointsize = 10, res = 300 ) plot_bivariate(my_points) #> Welcome to climr! #> Getting normals... #> Retrieving from cache... #> Getting historic... #> Retrieving from cache... #> Getting GCMs... #> Retrieving from cache... #> Retrieving from cache... #> Retrieving from cache... #> Retrieving from cache... #> Retrieving from cache... #> Retrieving from cache... #> Retrieving from cache... #> Retrieving from cache... #> Downscaling!! dev.off() #> agg_png  #>       2"},{"path":"https://bcgov.github.io/climr/reference/vancouver.html","id":null,"dir":"Reference","previous_headings":"","what":"Example line data — vancouver","title":"Example line data — vancouver","text":"Shapefile coast Vancouver, BC, Canada. Mostly used plotting. use data set, need terra::unwrap first, e.g.: vancouver <- terra::unwrap(get(data(vancouver)))","code":""},{"path":"https://bcgov.github.io/climr/reference/vancouver.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Example line data — vancouver","text":"","code":"vancouver"},{"path":"https://bcgov.github.io/climr/reference/vancouver.html","id":"format","dir":"Reference","previous_headings":"","what":"Format","title":"Example line data — vancouver","text":"PackedSpatVector","code":""},{"path":"https://bcgov.github.io/climr/reference/vancouver.html","id":"source","dir":"Reference","previous_headings":"","what":"Source","title":"Example line data — vancouver","text":"todo add/describe source","code":""},{"path":"https://bcgov.github.io/climr/reference/vancouver_points.html","id":null,"dir":"Reference","previous_headings":"","what":"Example point locations — vancouver_points","title":"Example point locations — vancouver_points","text":"Shapefile point locations North Vancouver, BC, Canada. use data set, need terra::unwrap first, e.g.: vancouver_points <- terra::unwrap(get(data(vancouver_points)))","code":""},{"path":"https://bcgov.github.io/climr/reference/vancouver_points.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Example point locations — vancouver_points","text":"","code":"vancouver_points"},{"path":"https://bcgov.github.io/climr/reference/vancouver_points.html","id":"format","dir":"Reference","previous_headings":"","what":"Format","title":"Example point locations — vancouver_points","text":"PackedSpatVector","code":""},{"path":"https://bcgov.github.io/climr/reference/vancouver_points.html","id":"source","dir":"Reference","previous_headings":"","what":"Source","title":"Example point locations — vancouver_points","text":"derived dem_vancouver","code":""},{"path":"https://bcgov.github.io/climr/reference/vancouver_poly.html","id":null,"dir":"Reference","previous_headings":"","what":"Example polygon locations — vancouver_poly","title":"Example polygon locations — vancouver_poly","text":"Shapefile North Vancouver polygon format, BC, Canada. use data set, need terra::unwrap first, e.g.: vancouver_poly <- terra::unwrap(get(data(vancouver_poly)))","code":""},{"path":"https://bcgov.github.io/climr/reference/vancouver_poly.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Example polygon locations — vancouver_poly","text":"","code":"vancouver_poly"},{"path":"https://bcgov.github.io/climr/reference/vancouver_poly.html","id":"format","dir":"Reference","previous_headings":"","what":"Format","title":"Example polygon locations — vancouver_poly","text":"PackedSpatVector","code":""},{"path":"https://bcgov.github.io/climr/reference/vancouver_poly.html","id":"source","dir":"Reference","previous_headings":"","what":"Source","title":"Example polygon locations — vancouver_poly","text":"derived dem_vancouver","code":""},{"path":"https://bcgov.github.io/climr/reference/variables.html","id":null,"dir":"Reference","previous_headings":"","what":"Available climate variables — variables","title":"Available climate variables — variables","text":"List available climate variables climr","code":""},{"path":"https://bcgov.github.io/climr/reference/variables.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Available climate variables — variables","text":"","code":"variables"},{"path":"https://bcgov.github.io/climr/reference/variables.html","id":"format","dir":"Reference","previous_headings":"","what":"Format","title":"Available climate variables — variables","text":"data.table columns: Code variable code name Variable variable description (full name) Time time year variable corresponds (e.g, summer, August, year) Category time resolution (e.g., annual, monthly, seasonal, etc.) Scale whether variable scaled, raw values","code":""},{"path":"https://bcgov.github.io/climr/reference/weather_stations.html","id":null,"dir":"Reference","previous_headings":"","what":"BC Weather Station Data - PCDS — weather_stations","title":"BC Weather Station Data - PCDS — weather_stations","text":"points shapefile weather stations BC Pacific Climate Impacts Consortium. Stations without elevation data excluded.","code":""},{"path":"https://bcgov.github.io/climr/reference/weather_stations.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"BC Weather Station Data - PCDS — weather_stations","text":"","code":"weather_stations"},{"path":"https://bcgov.github.io/climr/reference/weather_stations.html","id":"format","dir":"Reference","previous_headings":"","what":"Format","title":"BC Weather Station Data - PCDS — weather_stations","text":"PackedSpatVector","code":""},{"path":"https://bcgov.github.io/climr/reference/weather_stations.html","id":"source","dir":"Reference","previous_headings":"","what":"Source","title":"BC Weather Station Data - PCDS — weather_stations","text":"https://services.pacificclimate.org/met-data-portal-pcds/app/","code":""},{"path":"https://bcgov.github.io/climr/reference/weather_stations.html","id":"details","dir":"Reference","previous_headings":"","what":"Details","title":"BC Weather Station Data - PCDS — weather_stations","text":"use data set, need terra::unwrap first, e.g.: weather_stations <- terra::unwrap(get(data(weather_stations)))","code":""},{"path":"https://bcgov.github.io/climr/reference/xyzDT.html","id":null,"dir":"Reference","previous_headings":"","what":"Example table of point locations — xyzDT","title":"Example table of point locations — xyzDT","text":"data.table point locations elevation. simplified cleaned-version weather_stations dataset, incomplete cases removed.","code":""},{"path":"https://bcgov.github.io/climr/reference/xyzDT.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Example table of point locations — xyzDT","text":"","code":"xyzDT"},{"path":"https://bcgov.github.io/climr/reference/xyzDT.html","id":"format","dir":"Reference","previous_headings":"","what":"Format","title":"Example table of point locations — xyzDT","text":"data.table","code":""},{"path":"https://bcgov.github.io/climr/reference/xyzDT.html","id":"source","dir":"Reference","previous_headings":"","what":"Source","title":"Example table of point locations — xyzDT","text":"https://services.pacificclimate.org/met-data-portal-pcds/app/","code":""},{"path":[]},{"path":"https://bcgov.github.io/climr/news/index.html","id":"bug-fixes-0-0-4","dir":"Changelog","previous_headings":"","what":"Bug Fixes","title":"climr 0.0.4","text":"Updated future timeseries data include full 2015-2100 period added missing models (built cool bash scrips using parallel quickly raster2pgsql conversion large numbers files). Updated historic modelled timeseries extend 2015. Restructured naming scheme timeseries data, updated internal dbnames table, updated postgresql functions allow hyphens table names. Reprocessed future GCM periods include North America. Fixed bug plot_bivariate() focal periods 2001-2020. Fixed caching issue fail larger numbers layers (>65000) saving .gri binary files.","code":""},{"path":"https://bcgov.github.io/climr/news/index.html","id":"enhancements-0-0-4","dir":"Changelog","previous_headings":"","what":"Enhancements","title":"climr 0.0.4","text":"Added checks bounding box projection.","code":""},{"path":[]},{"path":"https://bcgov.github.io/climr/news/index.html","id":"enhancements-0-0-3","dir":"Changelog","previous_headings":"","what":"Enhancements","title":"climr 0.0.3","text":"new tests comparing reference outputs code streamlined new messages warn user meaningless downscale/climr_downscale argument combinations argument options climr_downscale(..., which_normal) now match options normal_input(..., normal) add plot_bivariate() function generate plots showing climate model ensemble variation recent future climate change. new functions list_historic_ts list_gcm_ts get available years historic/future time series","code":""},{"path":"https://bcgov.github.io/climr/news/index.html","id":"behaviour-changes-0-0-3","dir":"Changelog","previous_headings":"","what":"Behaviour changes","title":"climr 0.0.3","text":"xyz (argument climr_downscale downscale) in_xyz (argument get_bb), must now 4 column data.table (coercible class) lon, lat, elev id columns. columns ignored returned. Column order longer matters.","code":""},{"path":"https://bcgov.github.io/climr/news/index.html","id":"bugfixes-0-0-3","dir":"Changelog","previous_headings":"","what":"Bugfixes","title":"climr 0.0.3","text":"cache fixes fixing geographical checks get highest resolution beyond BC, Canada fixing historic_input_ts get queried years get_bb follows column names","code":""},{"path":"https://bcgov.github.io/climr/news/index.html","id":"other-0-0-3","dir":"Changelog","previous_headings":"","what":"Other","title":"climr 0.0.3","text":"climr_downscale now accepts ... pass arguments downscale","code":""},{"path":[]},{"path":"https://bcgov.github.io/climr/news/index.html","id":"bugfixes-0-0-2","dir":"Changelog","previous_headings":"","what":"Bugfixes","title":"climr 0.0.2","text":"fixed temperature values composite anomalies name composite anomalies changed “normal_composite” normal_input(..., normal).","code":""},{"path":"https://bcgov.github.io/climr/news/index.html","id":"documentation-0-0-2","dir":"Changelog","previous_headings":"","what":"Documentation","title":"climr 0.0.2","text":"added vignettes pkgdown website climr live","code":""},{"path":[]},{"path":"https://bcgov.github.io/climr/news/index.html","id":"enhancements-0-0-1","dir":"Changelog","previous_headings":"","what":"Enhancements","title":"climr 0.0.1","text":"continuous testing implemented via GitHub Actions code cleaned following tidyverse syntax recommendations internal function definitions now avoided improvements function documentation removal deprecated functions increased code coverage code streamlining added new composite climatologies Western Canada Western US.","code":""},{"path":"https://bcgov.github.io/climr/news/index.html","id":"bugfixes-0-0-1","dir":"Changelog","previous_headings":"","what":"Bugfixes","title":"climr 0.0.1","text":"fixed examples fixed incomplete changing package name (climRpnw climr) added missing pkg imports fixed caching problem cached objects retrieved PostGIS server unavailable fixed model names PostGIS server, fixed bugs gcm_hist_input gcm_ts_input.","code":""},{"path":"https://bcgov.github.io/climr/news/index.html","id":"dependency-changes-0-0-1","dir":"Changelog","previous_headings":"","what":"Dependency changes","title":"climr 0.0.1","text":"methods removed Imports sf added Imports","code":""},{"path":"https://bcgov.github.io/climr/news/index.html","id":"other-0-0-1","dir":"Changelog","previous_headings":"","what":"Other","title":"climr 0.0.1","text":"old data base access functions removed","code":""},{"path":"https://bcgov.github.io/climr/news/index.html","id":"climr-0009990","dir":"Changelog","previous_headings":"","what":"climr 0.0.0.9990","title":"climr 0.0.0.9990","text":"Beta-version","code":""}]
