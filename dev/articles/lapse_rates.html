<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="How lapse rates are calculated
">
<title>Lapse rates • climr</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.11/clipboard.min.js" integrity="sha512-7O5pXpc0oCRrxk8RUfDYFgn0nO1t+jLuIOQdOMRp4APB7uZ4vSjspzp5y6YDtDs4VzUSTbWzBFZ/LKJhnyFOKw==" crossorigin="anonymous" referrerpolicy="no-referrer"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Lapse rates">
<meta property="og:description" content="How lapse rates are calculated
">
<meta property="og:image" content="https://bcgov.github.io/climr/logo.svg">
<meta name="robots" content="noindex">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light" data-bs-theme="light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">climr</a>

    <small class="nav-text text-danger me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="In-development version">0.0.4.1</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <h6 class="dropdown-header" data-toc-skip>`climr` workflows</h6>
    <a class="dropdown-item" href="../articles/climr_workflow_beg.html">Beginner `climr` workflow</a>
    <a class="dropdown-item" href="../articles/climr_workflow_int.html">Intermediate `climr` workflow</a>
    <a class="dropdown-item" href="../articles/climr_with_rasters.html">Working with rasters and other spatial objects</a>
    <div class="dropdown-divider"></div>
    <h6 class="dropdown-header" data-toc-skip>Methods</h6>
    <a class="dropdown-item" href="../articles/methods_downscaling.html">`climr` downscaling methods</a>
    <a class="dropdown-item" href="../articles/methods_ensembleSelection.html">Global climate model ensemble selection</a>
    <a class="dropdown-item" href="../articles/lapse_rates.html">Lapse rates</a>
    <div class="dropdown-divider"></div>
    <a class="dropdown-item" href="../articles/index.html">More articles...</a>
  </div>
</li>
<li class="nav-item">
  <a class="nav-link" href="../news/index.html">Changelog</a>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav"></ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.svg" class="logo" alt=""><h1>Lapse rates</h1>
            
      
      
      <div class="d-none name"><code>lapse_rates.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="lapse-rates-calculation">Lapse rates calculation<a class="anchor" aria-label="anchor" href="#lapse-rates-calculation"></a>
</h2>
<p>From Wang (2016) Climate North America</p>
<blockquote>
<p>The algorithms then retrieve monthly climate data and elevation
values for a location from the corresponding grid cell plus eight
surrounding cells. The climate and elevation values of the nine cells
are used to calculate differences in a climate variable and in elevation
between all 36 possible pairs. A simple linear regression of the
differences in the climate variable on the difference in elevation is
then established, and the slope of the regression is used as the
empirical lapse rate for each climate variable at each specific
location. As the local regressions are dynamically developed along with
locations of inquiry, we call this downscaling method a “dynamic local
downscaling” approach. To avoid over-adjustments due to a weak linear
relationship, each lapse rate was weighted by the R-square value of the
local linear regression.</p>
</blockquote>
<p>The way this is done in this package, we precompute lapse rates for
each 36 variables and store them with the associated normal.</p>
</div>
<div class="section level2">
<h2 id="computation-details">Computation details<a class="anchor" aria-label="anchor" href="#computation-details"></a>
</h2>
<p>Starting with equal extent digital elevation model raster (x) and 36
climate variables rasters (pre delta method y’s).</p>
<p>We first convert rasters to matrices as this is way easier to handle
for this type of operation.</p>
<div class="float">
<img src="grid.svg" alt="Base matrix"><div class="figcaption">Base matrix</div>
</div>
<p>From there, since we want to compute everything in one swell swoop,
we create border extended matrices to handle lapse rates values at the
edge of a raster.</p>
<p>Starting with sides<br><img src="grid2.svg" alt="side extended matrix"></p>
<p>Then corners<br><img src="grid3.svg" alt="Corner extended matrix"></p>
<p>Next step is to sample the extended matrices 8 times and compute the
differences with the original matrices. This is going to give us a stack
of 8 matrices for each 36 variables that will be used to compute the
linear regression coefficients.</p>
<div class="float">
<img src="grid4.svg" alt="North-west sample"><div class="figcaption">North-west sample</div>
</div>
<div class="float">
<img src="grid5.svg" alt="North sample"><div class="figcaption">North sample</div>
</div>
<div class="float">
<img src="grid6.svg" alt="North-east sample"><div class="figcaption">North-east sample</div>
</div>
<div class="float">
<img src="grid7.svg" alt="East sample"><div class="figcaption">East sample</div>
</div>
<div class="float">
<img src="grid8.svg" alt="South-east sample"><div class="figcaption">South-east sample</div>
</div>
<div class="float">
<img src="grid9.svg" alt="South sample"><div class="figcaption">South sample</div>
</div>
<div class="float">
<img src="grid10.svg" alt="South-west sample"><div class="figcaption">South-west sample</div>
</div>
<div class="float">
<img src="grid11.svg" alt="West sample"><div class="figcaption">West sample</div>
</div>
<p>Regresssion coefficients are computed using the following methods and
the R² adjustment applied.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#' Simple linear regression without the intercept term</span></span>
<span><span class="co">#' beta_coef = sum(xy) / sum(x²)</span></span>
<span><span class="co">#' mss = sum(x * beta_coef)², sum of squared fitted values</span></span>
<span><span class="co">#' rss = sum(ε²), sum of squared (y minus fitted), sum of absolute errors</span></span>
<span><span class="co">#' R² = mss / (mss + rss)</span></span>
<span><span class="co">#' Lapse rate = beta_coef * R²</span></span></code></pre></div>
<p>Here is an example using two starting matrices</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="op">(</span><span class="va">dem</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span><span class="op">(</span><span class="fl">0</span><span class="op">:</span><span class="fl">1000</span>, <span class="fl">25</span><span class="op">)</span>, nrow <span class="op">=</span> <span class="fl">5</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt;      [,1] [,2] [,3] [,4] [,5]</span></span>
<span><span class="co">#&gt; [1,]  172  869  200  846  426</span></span>
<span><span class="co">#&gt; [2,]  406  878  196   76   61</span></span>
<span><span class="co">#&gt; [3,]  459  558  516  897  554</span></span>
<span><span class="co">#&gt; [4,]   62  926  766  445  772</span></span>
<span><span class="co">#&gt; [5,]  484  451  535  566  468</span></span></code></pre></div>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="op">(</span><span class="va">tmax</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fl">30</span> <span class="op">-</span> <span class="op">(</span><span class="va">dem</span> <span class="op">/</span> <span class="fl">50</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/r/base/Arithmetic.html" class="external-link">%/%</a></span> <span class="fl">1</span>, nrow <span class="op">=</span> <span class="fl">5</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt;      [,1] [,2] [,3] [,4] [,5]</span></span>
<span><span class="co">#&gt; [1,]   27   13   26   14   22</span></span>
<span><span class="co">#&gt; [2,]   22   13   27   29   29</span></span>
<span><span class="co">#&gt; [3,]   21   19   20   13   19</span></span>
<span><span class="co">#&gt; [4,]   29   12   15   22   15</span></span>
<span><span class="co">#&gt; [5,]   21   21   20   19   21</span></span></code></pre></div>
<p>Start by extending matrices</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">dem_ext</span> <span class="op">&lt;-</span> <span class="fu">climr</span><span class="fu">:::</span><span class="fu">recycle_borders</span><span class="op">(</span><span class="va">dem</span>, <span class="fl">5</span>, <span class="fl">5</span><span class="op">)</span></span>
<span><span class="co">#&gt; climr version 0.1.0 includes an overhaul of the naming conventions for variables, functions, parameters, and options. Call `data(name_changes)` for a table specifying the correspondence between old and new names. If you have used a previous version of climr you MUST call `cache_clear()` before using this one.</span></span></code></pre></div>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="op">(</span><span class="va">tmax_ext</span> <span class="op">&lt;-</span> <span class="fu">climr</span><span class="fu">:::</span><span class="fu">recycle_borders</span><span class="op">(</span><span class="va">tmax</span>, <span class="fl">5</span>, <span class="fl">5</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt;      [,1] [,2] [,3] [,4] [,5] [,6] [,7]</span></span>
<span><span class="co">#&gt; [1,]   27   27   13   26   14   22   22</span></span>
<span><span class="co">#&gt; [2,]   27   27   13   26   14   22   22</span></span>
<span><span class="co">#&gt; [3,]   22   22   13   27   29   29   29</span></span>
<span><span class="co">#&gt; [4,]   21   21   19   20   13   19   19</span></span>
<span><span class="co">#&gt; [5,]   29   29   12   15   22   15   15</span></span>
<span><span class="co">#&gt; [6,]   21   21   21   20   19   21   21</span></span>
<span><span class="co">#&gt; [7,]   21   21   21   20   19   21   21</span></span></code></pre></div>
<p>Sample 8 times</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">dem_d</span> <span class="op">&lt;-</span> <span class="fu">climr</span><span class="fu">:::</span><span class="fu">deltas</span><span class="op">(</span><span class="va">dem_ext</span>, <span class="fl">5</span>, <span class="fl">5</span><span class="op">)</span></span>
<span><span class="op">(</span><span class="va">tmax_d</span> <span class="op">&lt;-</span> <span class="fu">climr</span><span class="fu">:::</span><span class="fu">deltas</span><span class="op">(</span><span class="va">tmax_ext</span>, <span class="fl">5</span>, <span class="fl">5</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; $northwest</span></span>
<span><span class="co">#&gt;      [,1] [,2] [,3] [,4] [,5]</span></span>
<span><span class="co">#&gt; [1,]    0   14  -13   12   -8</span></span>
<span><span class="co">#&gt; [2,]    5   14  -14   -3  -15</span></span>
<span><span class="co">#&gt; [3,]    1    3   -7   14   10</span></span>
<span><span class="co">#&gt; [4,]   -8    9    4   -2   -2</span></span>
<span><span class="co">#&gt; [5,]    8    8   -8   -4    1</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $north</span></span>
<span><span class="co">#&gt;      [,1] [,2] [,3] [,4] [,5]</span></span>
<span><span class="co">#&gt; [1,]    0    0    0    0    0</span></span>
<span><span class="co">#&gt; [2,]    5    0   -1  -15   -7</span></span>
<span><span class="co">#&gt; [3,]    1   -6    7   16   10</span></span>
<span><span class="co">#&gt; [4,]   -8    7    5   -9    4</span></span>
<span><span class="co">#&gt; [5,]    8   -9   -5    3   -6</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $northeast</span></span>
<span><span class="co">#&gt;      [,1] [,2] [,3] [,4] [,5]</span></span>
<span><span class="co">#&gt; [1,]  -14   13  -12    8    0</span></span>
<span><span class="co">#&gt; [2,]   -9   13  -13   -7   -7</span></span>
<span><span class="co">#&gt; [3,]   -8    8    9   16   10</span></span>
<span><span class="co">#&gt; [4,]  -10    8   -2   -3    4</span></span>
<span><span class="co">#&gt; [5,]   -9   -6    2   -4   -6</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $east</span></span>
<span><span class="co">#&gt;      [,1] [,2] [,3] [,4] [,5]</span></span>
<span><span class="co">#&gt; [1,]  -14   13  -12    8    0</span></span>
<span><span class="co">#&gt; [2,]   -9   14    2    0    0</span></span>
<span><span class="co">#&gt; [3,]   -2    1   -7    6    0</span></span>
<span><span class="co">#&gt; [4,]  -17    3    7   -7    0</span></span>
<span><span class="co">#&gt; [5,]    0   -1   -1    2    0</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $southeast</span></span>
<span><span class="co">#&gt;      [,1] [,2] [,3] [,4] [,5]</span></span>
<span><span class="co">#&gt; [1,]  -14   14    3   15    7</span></span>
<span><span class="co">#&gt; [2,]   -3    7  -14  -10  -10</span></span>
<span><span class="co">#&gt; [3,]   -9   -4    2    2   -4</span></span>
<span><span class="co">#&gt; [4,]   -8    8    4   -1    6</span></span>
<span><span class="co">#&gt; [5,]    0   -1   -1    2    0</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $south</span></span>
<span><span class="co">#&gt;      [,1] [,2] [,3] [,4] [,5]</span></span>
<span><span class="co">#&gt; [1,]   -5    0    1   15    7</span></span>
<span><span class="co">#&gt; [2,]   -1    6   -7  -16  -10</span></span>
<span><span class="co">#&gt; [3,]    8   -7   -5    9   -4</span></span>
<span><span class="co">#&gt; [4,]   -8    9    5   -3    6</span></span>
<span><span class="co">#&gt; [5,]    0    0    0    0    0</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $southwest</span></span>
<span><span class="co">#&gt;      [,1] [,2] [,3] [,4] [,5]</span></span>
<span><span class="co">#&gt; [1,]   -5    9  -13   13    7</span></span>
<span><span class="co">#&gt; [2,]   -1    8   -8   -9  -16</span></span>
<span><span class="co">#&gt; [3,]    8   10   -8    2    3</span></span>
<span><span class="co">#&gt; [4,]   -8    9    6   -2    4</span></span>
<span><span class="co">#&gt; [5,]    0    0    1    1   -2</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $west</span></span>
<span><span class="co">#&gt;      [,1] [,2] [,3] [,4] [,5]</span></span>
<span><span class="co">#&gt; [1,]    0   14  -13   12   -8</span></span>
<span><span class="co">#&gt; [2,]    0    9  -14   -2    0</span></span>
<span><span class="co">#&gt; [3,]    0    2   -1    7   -6</span></span>
<span><span class="co">#&gt; [4,]    0   17   -3   -7    7</span></span>
<span><span class="co">#&gt; [5,]    0    0    1    1   -2</span></span></code></pre></div>
<p>Now compute relevant coefficients</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Number of surrounding cells</span></span>
<span><span class="va">n</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">dem_d</span><span class="op">)</span></span>
<span><span class="co"># Sums of x squared</span></span>
<span><span class="va">sum_xx</span> <span class="op">&lt;-</span> <span class="fu">climr</span><span class="fu">:::</span><span class="fu">sum_matrix</span><span class="op">(</span></span>
<span>  <span class="fu">climr</span><span class="fu">:::</span><span class="fu"><a href="https://rdrr.io/r/grDevices/plotmath.html" class="external-link">sup</a></span><span class="op">(</span><span class="va">dem_d</span>, <span class="fl">2</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="va">beta_coef</span> <span class="op">&lt;-</span> <span class="fu">climr</span><span class="fu">:::</span><span class="fu">sum_matrix</span><span class="op">(</span></span>
<span>  <span class="fu">climr</span><span class="fu">:::</span><span class="fu">prod_matrix</span><span class="op">(</span><span class="va">dem_d</span>, <span class="va">tmax_d</span><span class="op">)</span></span>
<span><span class="op">)</span> <span class="op">/</span> <span class="va">sum_xx</span></span>
<span><span class="co"># We need the fitted values to compute the</span></span>
<span><span class="co"># coefficient of determination</span></span>
<span><span class="va">f</span> <span class="op">&lt;-</span> <span class="fu">climr</span><span class="fu">:::</span><span class="fu"><a href="https://rdrr.io/r/stats/fitted.values.html" class="external-link">fitted</a></span><span class="op">(</span><span class="va">dem_d</span>, <span class="va">beta_coef</span><span class="op">)</span></span>
<span><span class="co"># We use the same approach as stats::summary.lm</span></span>
<span><span class="co"># applied to a list matrices</span></span>
<span><span class="va">mss</span> <span class="op">&lt;-</span> <span class="fu">climr</span><span class="fu">:::</span><span class="fu">sum_matrix</span><span class="op">(</span></span>
<span>  <span class="fu">climr</span><span class="fu">:::</span><span class="fu"><a href="https://rdrr.io/r/grDevices/plotmath.html" class="external-link">sup</a></span><span class="op">(</span><span class="va">f</span>, <span class="fl">2</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="va">rss</span> <span class="op">&lt;-</span> <span class="fu">climr</span><span class="fu">:::</span><span class="fu">sum_matrix</span><span class="op">(</span></span>
<span>  <span class="fu">climr</span><span class="fu">:::</span><span class="fu"><a href="https://rdrr.io/r/grDevices/plotmath.html" class="external-link">sup</a></span><span class="op">(</span></span>
<span>    <span class="fu">climr</span><span class="fu">:::</span><span class="fu">delta_matrix</span><span class="op">(</span><span class="va">tmax_d</span>, <span class="va">f</span><span class="op">)</span>,</span>
<span>    <span class="fl">2</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="co"># We can combine the resulting matrices to get the</span></span>
<span><span class="co"># coefficient of determination and multiply by beta coficient</span></span>
<span><span class="op">(</span><span class="va">lapse_rate</span> <span class="op">&lt;-</span> <span class="va">beta_coef</span> <span class="op">*</span> <span class="va">mss</span> <span class="op">/</span> <span class="op">(</span><span class="va">mss</span> <span class="op">+</span> <span class="va">rss</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt;             [,1]        [,2]        [,3]        [,4]        [,5]</span></span>
<span><span class="co">#&gt; [1,] -0.02008744 -0.01991429 -0.01905148 -0.01914296 -0.01924584</span></span>
<span><span class="co">#&gt; [2,] -0.01963220 -0.01959146 -0.02044560 -0.01978590 -0.01938747</span></span>
<span><span class="co">#&gt; [3,] -0.01960868 -0.01996766 -0.01982820 -0.01927210 -0.01988396</span></span>
<span><span class="co">#&gt; [4,] -0.01974567 -0.01959050 -0.01996064 -0.02104873 -0.01960000</span></span>
<span><span class="co">#&gt; [5,] -0.01927916 -0.01898502 -0.02007731 -0.02041018 -0.01978681</span></span></code></pre></div>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Kiri Daust, Colin Mahony, Bruno Tremblay, Ceres Barros, Province of British Columbia.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.9.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
